# 부산시 행정동별 “강아지 키우기 좋은 동네” 데이터 분석 시스템 설계

## 1. 아키텍처 개요

본 시스템은 데이터 수집/분석/시각화/서비스 제공을 통합적으로 지원하는 웹 기반 공간 데이터 분석 플랫폼입니다.  
Clean Architecture를 적용하여, 핵심 도메인 로직과 외부 인터페이스(웹, 데이터베이스, API 등)를 명확히 분리합니다.

```mermaid
graph TD
    A[외부 데이터 소스] --> B[ETL/수집 파이프라인]
    B --> C[도메인 계층 - 분석/점수화]
    C --> D[DB(PostGIS)]
    C --> E[API 서비스(FastAPI)]
    E --> F[프론트엔드(React/Mapbox)]
```

---

## 2. 계층별 설계

### 2.1 데이터 수집 및 ETL 계층
- **역할**: 공공데이터, 카카오맵 등에서 데이터 수집 및 정제, 공간 좌표계 통일, 결측/오류 데이터 처리, DB 적재
- **구현**: Python, Pandas, Geopandas, requests, Selenium, Airflow(스케줄링)
- **구성요소**:
  - 데이터 소스 커넥터 (공공데이터, 외부 API)
  - 데이터 정제/정규화 모듈 (좌표계 변환, 주소 매핑)
  - ETL 워크플로우 (Airflow DAG)

### 2.2 도메인(비즈니스 로직) 계층
- **역할**: 
  - 동별 인프라/산책로/교통 등 데이터 표준화 및 가중치 적용
  - 종합 점수 산정(가중합, 표준화)
  - 공간 연산(행정동별 집계, spatial join)
- **구현**: Python, Numpy, Scikit-learn, Shapely, Geopandas
- **구성요소**:
  - 표준화/정규화 서비스
  - 가중치 관리 서비스
  - 점수 산정 엔진
  - 공간 데이터 집계 서비스

### 2.3 데이터 저장 계층
- **역할**: 공간 데이터 및 분석 결과 저장, 효율적 쿼리 지원
- **구현**: PostgreSQL + PostGIS
- **구성요소**:
  - 행정동 공간 테이블
  - 인프라/산책로/기타 지표 테이블
  - 동별 점수/랭킹 결과 테이블

### 2.4 API 서비스 계층
- **역할**: 외부(프론트엔드)와 도메인 계층 연결, RESTful API 제공
- **구현**: FastAPI (Python)
- **구성요소**:
  - 동별 점수/랭킹 조회 API
  - 지도 데이터(GeoJSON 등) 제공 API
  - 사용자 가중치 반영 API
  - Swagger/OpenAPI 문서 자동화

### 2.5 프론트엔드(웹) 계층
- **역할**: 사용자에게 결과 시각화, 인터랙티브 지도 제공, 가중치 조정 등 인터페이스 제공
- **구현**: React, Mapbox GL JS, deck.gl, Material-UI
- **구성요소**:
  - 동별 히트맵/랭킹 지도
  - 가중치 슬라이더/필터 UI
  - 상세 정보(툴팁, 팝업)
  - 결과물(지도, 랭킹표 등) 다운로드 기능

---

## 3. 데이터 흐름

1. **데이터 수집**: ETL 파이프라인이 주기적으로 외부 데이터 소스에서 데이터를 수집, 정제 후 DB에 저장
2. **분석/집계**: 도메인 계층에서 DB 데이터를 불러와 표준화/가중치/공간 집계 후 점수 산출
3. **API 제공**: FastAPI가 분석 결과 및 지도 데이터를 REST API로 제공
4. **시각화/서비스**: 프론트엔드에서 지도/랭킹 등 결과를 시각화, 사용자 입력(가중치 등) 반영

---

## 4. 주요 컴포넌트 상세

### 4.1 ETL/수집 파이프라인
- Airflow DAG으로 스케줄링
- 데이터 소스별 커넥터 클래스 (SOLID 원칙: OCP, SRP)
- 데이터 정제/좌표계 통일 유틸리티

### 4.2 도메인 서비스
- 표준화/정규화 서비스: 각 지표별로 분리(SRP)
- 가중치 관리: 사용자 입력값을 서비스 계층에서 주입(DIP)
- 점수 산정 엔진: 전략 패턴 적용(가중합, 표준화 등 다양한 방식 지원)

### 4.3 API 서비스
- FastAPI 기반 RESTful 엔드포인트
- 의존성 주입(DI)으로 서비스/리포지토리 분리
- Swagger 문서 자동화

### 4.4 프론트엔드
- React 컴포넌트 분리(지도, 슬라이더, 표 등)
- Mapbox/Deck.gl로 대용량 공간 데이터 시각화
- 상태 관리(Redux Toolkit)로 가중치/필터 반영

---

## 5. 확장성/유지보수 고려
- Clean Architecture 기반 계층 분리로 테스트 용이, 기능 추가/변경에 유연
- 데이터 소스 추가 시 커넥터만 확장하면 됨 (OCP)
- 공간 데이터 처리/분석 로직은 도메인 계층에 집중
- 프론트엔드/백엔드 독립적 배포 및 확장 가능

---

## 6. 보안 및 개인정보 보호
- 모든 위치 정보는 공공 인프라 단위로만 저장/활용
- 개인정보(이름, 연락처 등) 수집/저장/분석 일절 없음

---

## 7. 개발 및 배포 환경
- Docker 기반 컨테이너화, GitHub Actions 통한 CI/CD
- AWS EC2, RDS(PostGIS), S3 활용
- Poetry로 패키지/환경 관리, Black/isort/flake8로 코드 품질 유지
