<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>ë¶€ì‚°ì—ì„œ ê°•ì•„ì§€ í‚¤ìš°ê¸° ì¢‹ì€ ë™ë„¤</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<style>
      body {
        margin: 0;
        padding: 0px 32px 32px 32px;
        font-family: "Noto Sans KR", Arial, sans-serif;
        background: #f7f7fa;
        overflow-x: hidden;
      }

      /* ìˆ˜ì§ ì—¬ë°± ì¶”ê°€ */
      .container {
        margin: 40px 0;
        display: flex;
        flex-direction: row;
        width: 100%;
        height: calc(100vh - 77px);
        min-height: 500px;
      }
      
      .left-map {
        margin-top: 16px;
        margin-bottom: 16px;
        width: 50%;
        min-width: 320px;
        height: 100%;
        margin-right: 24px; /* Add margin between columns */
      }
      
      .right-panel {
        margin-top: 16px;
        margin-bottom: 16px;
        width: 50%;
        min-width: 320px;
        height: 100%;
        display: flex;
        flex-direction: column;
        background: #f7f7fa;
      }
      
      .custom-recommendation {
        margin-top: 16px;
        margin-bottom: 16px;
        background-color: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin-bottom: 20px;
      }
      
      .facility-table {
        margin-top: 16px;
        margin-bottom: 16px;
      }
      
      .ranking-container {
        margin-top: 20px;
        margin-bottom: 16px;
      }
      
      .explanation {
        margin-top: 20px;
        color: #4a5568;
        font-size: 0.95em;
        background-color: #f8f9ff;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #4285f4;
      }

      .explanation h4 {
        color: #2d3748;
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 1.1em;
      }

      .explanation h5 {
        color: #4a5568;
        margin: 15px 0 5px 0;
        font-size: 1em;
        font-weight: 600;
      }

      .explanation p {
        margin: 5px 0;
        line-height: 1.5;
      }

      .explanation ul.guide-list {
        margin: 5px 0 15px 20px;
        padding: 0;
        font-size: 0.9em;
      }

      .explanation ul.guide-list li {
        margin-bottom: 5px;
      }

      .explanation small {
        display: block;
        margin-bottom: 5px;
      }

      .small-note {
        margin-top: 10px;
        font-style: italic;
        color: #718096;
        font-size: 0.9em;
      }

      .header {
        width: 100vw;
        margin-left: calc(-1 * (32px));
        margin-right: calc(-1 * (32px));
        background: #3b82f6;
        color: #fff;
        font-size: 2rem;
        font-weight: bold;
        text-align: center;
        padding: 1.5rem 0 1.2rem 0;
        letter-spacing: -1px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      }
      
      .map-iframe {
        width: 100%;
        height: 100%;
        border: none;
        display: block;
      }
      
      .right-top,
      .right-bottom {
        flex: 1;
        padding: 0;
        border-bottom: 1px solid #e5e7eb;
        background: #fff;
        overflow-y: auto;
      }
      
      .right-bottom {
        border-bottom: none;
        background: #f0f6ff;
      }
      
      /* ìš°ì„ ìˆœìœ„ ì„ íƒ ìŠ¤íƒ€ì¼ */
      .priority-selection {
        margin: 20px 0;
      }
      
      .priority-group {
        margin-bottom: 15px;
      }
      
      .priority-group h4 {
        margin: 5px 0;
        font-size: 1rem;
        color: #334155;
      }
      
      .priority-buttons {
        display: flex;
        gap: 8px;
      }
      
      .priority-btn {
        flex: 1;
        padding: 8px;
        border: 1px solid #ddd;
        background: #f5f5f5;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .priority-btn.selected {
        background: #3b82f6;
        color: white;
        border-color: #2563eb;
      }
      
      .priority-btn:hover:not(.selected) {
        background: #e0e7ff;
      }
      
      .action-buttons {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }
      
      .action-btn {
        flex: 1;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        font-weight: bold;
        cursor: pointer;
      }
      
      #calculate-btn {
        background: #10b981;
        color: white;
      }
      
      #calculate-btn:disabled {
        background: #94a3b8;
        cursor: not-allowed;
      }
      
      #reset-btn {
        background: #f3f4f6;
        color: #4b5563;
      }
      
      #ranking-list li {
        margin-bottom: 5px;
        padding: 8px;
        border-radius: 4px;
      }
      
      #ranking-list li:nth-child(1) {
        background-color: #fff6e6;
        font-weight: bold;
      }
      
      #ranking-list li:nth-child(2), #ranking-list li:nth-child(3) {
        background-color: #f9f9fb;
      }
      
      .chart-container {
        margin: 20px 0;
        height: 300px;
        position: relative;
      }
      
      /* ê³„ì‚° ê³¼ì • ìƒì„¸ ì„¤ëª… ìŠ¤íƒ€ì¼ */
      .chart-explanation-container {
        margin-top: 20px;
        background-color: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #dee2e6;
        padding: 15px;
      }
      
      .calculation-details h4 {
        color: #495057;
        margin-top: 0;
        margin-bottom: 15px;
      }
      
      .priority-info h5, .district-calculation h5 {
        color: #495057;
        margin-top: 10px;
        margin-bottom: 12px;
        font-weight: 600;
      }
      
      .score-details {
        margin-bottom: 15px;
      }
      
      .priority-table, .calculation-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 15px;
        font-size: 0.95em;
      }
      
      .priority-table th, .calculation-table th {
        background-color: #e9ecef;
        padding: 8px;
        text-align: center;
        border: 1px solid #dee2e6;
        font-weight: 600;
      }
      
      .priority-table td, .calculation-table td {
        padding: 6px 8px;
        text-align: center;
        border: 1px solid #dee2e6;
      }
      
      .calculation-table tr:hover {
        background-color: #f1f3f5;
      }
      
      .total-row {
        font-weight: bold;
        background-color: #e9ecef;
      }
      
      .total-label {
        text-align: right;
        padding-right: 10px;
      }
      
      .total-value {
        text-align: center;
        color: #2563eb;
      }
      
      .score-details hr {
        margin: 15px 0;
        border: 0;
        height: 1px;
        background-color: #dee2e6;
      }
      
      @media (max-width: 900px) {
        .container {
          flex-direction: column;
        }
        .left-map,
        .right-panel {
          width: 100%;
          min-width: 0;
          margin-right: 0 !important;
        }
        .left-map {
          height: 50%;
        }
        .right-panel {
          height: 50%;
          flex-direction: row;
        }
        .right-top,
        .right-bottom {
          flex: 1;
          padding: 1rem;
          border-bottom: none;
          border-right: 1px solid #e5e7eb;
        }
        .right-bottom {
          border-right: none;
        }
      }
    </style>
</head>
<body>
<div class="header">ë¶€ì‚°ì—ì„œ ê°•ì•„ì§€ í‚¤ìš°ê¸° ì¢‹ì€ ë™ë„¤</div>
<div class="container">
<div class="left-map">
<iframe class="map-iframe" src="./vet_hospitals_busan_map.html"></iframe>
</div>
<div class="right-panel">
<div class="right-top">
<div class="custom-recommendation">
<h3>ğŸ¯ ë§ì¶¤í˜• ë™ë„¤ ì¶”ì²œ</h3>
<p>ì‹œì„¤ ìš°ì„ ìˆœìœ„ë¥¼ ì„ íƒí•˜ì—¬ ë‚˜ì—ê²Œ ë§ëŠ” ë™ë„¤ë¥¼ ì°¾ì•„ë³´ì„¸ìš”.</p>
<div class="priority-selection">
<div class="priority-group">
<h4>ğŸ¥ ë™ë¬¼ë³‘ì›</h4>
<div class="priority-buttons">
<button class="priority-btn" data-facility="hospital" data-priority="1">1ìˆœìœ„</button>
<button class="priority-btn" data-facility="hospital" data-priority="2">2ìˆœìœ„</button>
<button class="priority-btn" data-facility="hospital" data-priority="3">3ìˆœìœ„</button>
</div>
</div>
<div class="priority-group">
<h4>â˜• ì• ê²¬ì¹´í˜</h4>
<div class="priority-buttons">
<button class="priority-btn" data-facility="cafe" data-priority="1">1ìˆœìœ„</button>
<button class="priority-btn" data-facility="cafe" data-priority="2">2ìˆœìœ„</button>
<button class="priority-btn" data-facility="cafe" data-priority="3">3ìˆœìœ„</button>
</div>
</div>
<div class="priority-group">
<h4>ğŸŒ³ ê³µì›</h4>
<div class="priority-buttons">
<button class="priority-btn" data-facility="park" data-priority="1">1ìˆœìœ„</button>
<button class="priority-btn" data-facility="park" data-priority="2">2ìˆœìœ„</button>
<button class="priority-btn" data-facility="park" data-priority="3">3ìˆœìœ„</button>
</div>
</div>
<div class="action-buttons">
<button class="action-btn" disabled="" id="calculate-btn">ê²°ê³¼ ê³„ì‚°í•˜ê¸°</button>
<button class="action-btn" id="reset-btn">ì´ˆê¸°í™”</button>
</div>
</div>
<div class="ranking-container">
<h4>ë§ì¶¤ ì¶”ì²œ ìˆœìœ„ (Top 3)</h4>
<ol id="ranking-list">
<!-- ìˆœìœ„ëŠ” JavaScriptë¡œ ë™ì  ìƒì„± -->
</ol>
</div>
<div class="chart-container">
<canvas id="ranking-chart"></canvas>
</div>
<div class="chart-explanation-container">
<div class="calculation-details">
<h4>TOP 3 ë™ë„¤ ì ìˆ˜ ê³„ì‚° ê³¼ì •</h4>
<div class="score-details" id="calculation-explanation">
<!-- ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ê³„ì‚° ê³¼ì •ì´ í‘œì‹œë©ë‹ˆë‹¤ -->
</div>
</div>
<div class="explanation">
<h4>ì ìˆ˜ ê³„ì‚° ë°©ì‹ ì„¤ëª…</h4>
<p>í˜„ì¬ ì ìˆ˜ ê³„ì‚°ì€ ì •ê·œí™”(Normalization)ì™€ ìµœì†Œ ìš”êµ¬ì‚¬í•­ í•„í„°ë§ì„ ì ìš©í•œ ë°©ì‹ì…ë‹ˆë‹¤.</p>
<h5>1. ì •ê·œí™” ì ìš©</h5>
<p class="calc-detail">ê° ì‹œì„¤ ìœ í˜•(ë™ë¬¼ë³‘ì›, ì• ê²¬ì¹´í˜, ê³µì›)ë³„ë¡œ ì§€ì—­ ê°„ ë¹„êµë¥¼ ê³µì •í•˜ê²Œ í•˜ê¸° ìœ„í•´ ì‹œì„¤ ìˆ˜ë¥¼ 0~1 ì‚¬ì´ ê°’ìœ¼ë¡œ ì •ê·œí™”í•©ë‹ˆë‹¤.</p>
<ul class="guide-list">
<li>ì •ê·œí™” ê³µì‹: (í•´ë‹¹ ì§€ì—­ ì‹œì„¤ ìˆ˜ - ìµœì†Œ ì‹œì„¤ ìˆ˜) / (ìµœëŒ€ ì‹œì„¤ ìˆ˜ - ìµœì†Œ ì‹œì„¤ ìˆ˜)</li>
</ul>
<h5>2. ìµœì†Œ ìš”êµ¬ì‚¬í•­ í•„í„°ë§</h5>
<p class="calc-detail">1ìˆœìœ„ë¡œ ì„ íƒí•œ ì‹œì„¤ì´ ìµœì†Œ 1ê°œ ì´ìƒ ìˆëŠ” ì§€ì—­ë§Œ ê²°ê³¼ì— í¬í•¨ë©ë‹ˆë‹¤.</p>
<ul class="guide-list">
<li>ì˜ˆ: ì• ê²¬ì¹´í˜ë¥¼ 1ìˆœìœ„ë¡œ ì„ íƒí•˜ë©´, ì• ê²¬ì¹´í˜ê°€ ì—†ëŠ” ì§€ì—­ì€ ì•„ë¬´ë¦¬ ë‹¤ë¥¸ ì ìˆ˜ê°€ ë†’ì•„ë„ ì œì™¸ë©ë‹ˆë‹¤.</li>
</ul>
<h5>3. ê°€ì¤‘ì¹˜ ì ìš© ë° ìµœì¢… ì ìˆ˜ ê³„ì‚°</h5>
<p class="calc-detail">ì •ê·œí™”ëœ ì‹œì„¤ ìˆ˜ì— ìš°ì„ ìˆœìœ„ë³„ ê°€ì¤‘ì¹˜ë¥¼ ê³±í•˜ì—¬ ìµœì¢… ì ìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.</p>
<ul class="guide-list">
<li>1ìˆœìœ„: ê°€ì¤‘ì¹˜ 2.0ì </li>
<li>2ìˆœìœ„: ê°€ì¤‘ì¹˜ 1.5ì </li>
<li>3ìˆœìœ„: ê°€ì¤‘ì¹˜ 1.0ì </li>
<li>ìµœì¢… ì ìˆ˜ = (ë™ë¬¼ë³‘ì› ì •ê·œí™” ì ìˆ˜ Ã— ë³‘ì› ê°€ì¤‘ì¹˜) + (ì• ê²¬ì¹´í˜ ì •ê·œí™” ì ìˆ˜ Ã— ì¹´í˜ ê°€ì¤‘ì¹˜) + (ê³µì› ì •ê·œí™” ì ìˆ˜ Ã— ê³µì› ê°€ì¤‘ì¹˜)</li>
</ul>
</div>
</div>
<div class="small-note">
<small>â€» ë¶€ì‚° ì „ì²´ì—ëŠ” ë™ë¬¼ë³‘ì› 447ê°œ, ì• ê²¬ì¹´í˜ 98ê°œ, ê³µì› 1,229ê°œ(í•„í„°ë§ ì ìš©)ê°€ ìˆìŠµë‹ˆë‹¤. í–‰ì •ë™ë³„ ê³µì› ìˆ˜ëŠ” ê³µê°„ ë§¤í•‘ìœ¼ë¡œ í™•ì¸í•œ ì •í™•í•œ ê°’ì…ë‹ˆë‹¤.</small>
</div>
</div>
<style>
        .custom-recommendation {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .weight-sliders {
            margin: 20px 0;
        }
        
        .slider-container {
            margin-bottom: 15px;
        }
        
        .weight-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: #f0f0f0;
            outline: none;
            border-radius: 5px;
        }
        
        .weight-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #4285f4;
            cursor: pointer;
        }
        
        .chart-container {
            margin: 20px 0;
            height: 300px;
            position: relative;
        }
        
        .ranking-container {
            margin-top: 20px;
        }
        
        #ranking-list li {
            margin-bottom: 5px;
            padding: 8px;
            border-radius: 4px;
        }
        
        #ranking-list li:nth-child(1) {
            background-color: #fff6e6;
            font-weight: bold;
        }
        
        #ranking-list li:nth-child(2), #ranking-list li:nth-child(3) {
            background-color: #f9f9fb;
        }
        
        .explanation {
            margin-top: 15px;
            color: #666;
            font-size: 0.9em;
        }
        
        .explanation small {
            display: block;
            margin-bottom: 5px;
        }
    </style>
</div>
</div>
</div>
<style>
        .custom-recommendation {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .weight-sliders {
            margin: 20px 0;
        }
        
        .slider-container {
            margin-bottom: 15px;
        }
        
        .weight-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: #f0f0f0;
            outline: none;
            border-radius: 5px;
        }
        
        .weight-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #4285f4;
            cursor: pointer;
        }
        
        .chart-container {
            margin: 20px 0;
            height: 300px;
            position: relative;
        }
        
        .ranking-container {
            margin-top: 20px;
        }
        
        #ranking-list li {
            margin-bottom: 5px;
            padding: 8px;
            border-radius: 4px;
        }
        
        #ranking-list li:nth-child(1) {
            background-color: #fff6e6;
            font-weight: bold;
        }
        
        #ranking-list li:nth-child(2), #ranking-list li:nth-child(3) {
            background-color: #f9f9fb;
        }
        
        .explanation {
            margin-top: 15px;
            color: #666;
            font-size: 0.9em;
        }
        
        .explanation small {
            display: block;
            margin-bottom: 5px;
        }
        
        .guide-list {
            padding-left: 1.5rem;
        }
        .guide-list li {
            margin-bottom: 0.8rem;
        }
        .legend {
            margin-top: 1.5rem;
        }
    </style>

<script>
// í–‰ì •ë™ë³„ ì‹œì„¤ ë°ì´í„° (í•„í„°ë§ëœ ë°ì´í„° ê¸°ì¤€, ê³µì› ë°ì´í„° ì •í™•íˆ ë§¤í•‘)
const districtData = [
    { district: 'ì¢Œ2ë™', hospital: 17, cafe: 2, park: 7 },
    { district: 'ì–‘ì •1ë™', hospital: 14, cafe: 1, park: 1 },
    { district: 'êµ¬ì„œ1ë™', hospital: 11, cafe: 0, park: 2 },
    { district: 'ì¤‘1ë™', hospital: 11, cafe: 0, park: 6 },
    { district: 'ìš°3ë™', hospital: 11, cafe: 0, park: 3 },
    { district: 'ì¥ì „2ë™', hospital: 10, cafe: 0, park: 1 },
    { district: 'ëª…ì§€1ë™', hospital: 7, cafe: 3, park: 18 },
    { district: 'ë¯¼ë½ë™', hospital: 5, cafe: 4, park: 6 },
    { district: 'ì •ê´€ì', hospital: 5, cafe: 3, park: 31 },
    { district: 'ë‚¨ì²œ1ë™', hospital: 7, cafe: 1, park: 1 },
    { district: 'ì¢Œ1ë™', hospital: 5, cafe: 2, park: 2 },
    { district: 'ë‚¨í¬ë™', hospital: 5, cafe: 2, park: 0 },
    { district: 'ìš©í˜¸1ë™', hospital: 6, cafe: 1, park: 3 },
    { district: 'ì˜¨ì²œ2ë™', hospital: 7, cafe: 0, park: 7 },
    { district: 'ìš°1ë™', hospital: 6, cafe: 0, park: 10 }
];

// ê°€ì¤‘ì¹˜ ì„¤ì •
const weights = {
    hospital: { value: 0, priority: 0 },
    cafe: { value: 0, priority: 0 },
    park: { value: 0, priority: 0 }
};

// ê°€ì¤‘ì¹˜ ê°’ ì •ì˜
const priorityValues = {
    1: 2.0,   // 1ìˆœìœ„: 2ì 
    2: 1.5,   // 2ìˆœìœ„: 1.5ì 
    3: 1.0    // 3ìˆœìœ„: 1ì 
};

let rankingChart = null;

// DOM ë¡œë”© í›„ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', () => {
    // ìš°ì„ ìˆœìœ„ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    const priorityButtons = document.querySelectorAll('.priority-btn');
    priorityButtons.forEach(btn => {
        btn.addEventListener('click', handlePrioritySelection);
    });

    // ê³„ì‚° ë²„íŠ¼ ì´ë²¤íŠ¸
    document.getElementById('calculate-btn').addEventListener('click', calculateRanking);
    
    // ì´ˆê¸°í™” ë²„íŠ¼ ì´ë²¤íŠ¸
    document.getElementById('reset-btn').addEventListener('click', resetPriorities);
});

// ìš°ì„ ìˆœìœ„ ì„ íƒ ì²˜ë¦¬
function handlePrioritySelection(e) {
    const facility = e.target.dataset.facility;
    const priority = parseInt(e.target.dataset.priority);
    
    // ê°™ì€ ì‹œì„¤ì˜ ë‹¤ë¥¸ ë²„íŠ¼ì—ì„œ ì„ íƒ í•´ì œ
    const facilityButtons = document.querySelectorAll(`.priority-btn[data-facility="${facility}"]`);
    facilityButtons.forEach(btn => btn.classList.remove('selected'));
    
    // í˜„ì¬ ë²„íŠ¼ì— ì„ íƒ í‘œì‹œ
    e.target.classList.add('selected');
    
    // ë‹¤ë¥¸ ì‹œì„¤ì—ì„œ ê°™ì€ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì§„ ë²„íŠ¼ ì°¾ê¸°
    Object.keys(weights).forEach(key => {
        if (key !== facility && weights[key].priority === priority) {
            // ë‹¤ë¥¸ ì‹œì„¤ì˜ ê°™ì€ ìš°ì„ ìˆœìœ„ ë²„íŠ¼ ì„ íƒ í•´ì œ
            const conflictButtons = document.querySelectorAll(`.priority-btn[data-facility="${key}"][data-priority="${priority}"]`);
            conflictButtons.forEach(btn => btn.classList.remove('selected'));
            
            // í•´ë‹¹ ì‹œì„¤ì˜ ìš°ì„ ìˆœìœ„ ì´ˆê¸°í™”
            weights[key].priority = 0;
            weights[key].value = 0;
        }
    });
    
    // ìš°ì„ ìˆœìœ„ ë° ê°€ì¤‘ì¹˜ ì„¤ì •
    weights[facility].priority = priority;
    weights[facility].value = priorityValues[priority];
    
    // ê³„ì‚° ë²„íŠ¼ í™œì„±í™” ì—¬ë¶€ ê²°ì •
    updateCalculateButtonState();
}

// ê³„ì‚° ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
function updateCalculateButtonState() {
    // 3ê°œ ì‹œì„¤ ëª¨ë‘ ìš°ì„ ìˆœìœ„ê°€ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸
    const isAllSet = Object.values(weights).every(w => w.priority > 0);
    document.getElementById('calculate-btn').disabled = !isAllSet;
}

// ìš°ì„ ìˆœìœ„ ì´ˆê¸°í™”
function resetPriorities() {
    // ëª¨ë“  ì„ íƒ ë²„íŠ¼ í•´ì œ
    document.querySelectorAll('.priority-btn').forEach(btn => {
        btn.classList.remove('selected');
    });
    
    // ê°€ì¤‘ì¹˜ ì´ˆê¸°í™”
    Object.keys(weights).forEach(key => {
        weights[key].priority = 0;
        weights[key].value = 0;
    });
    
    // ê³„ì‚° ë²„íŠ¼ ë¹„í™œì„±í™”
    document.getElementById('calculate-btn').disabled = true;
    
    // ìˆœìœ„ ëª©ë¡ ë° ì°¨íŠ¸ ì´ˆê¸°í™”
    document.getElementById('ranking-list').innerHTML = '';
    if (rankingChart) {
        rankingChart.destroy();
        rankingChart = null;
    }
}

// ìˆœìœ„ ê³„ì‚° ë° í‘œì‹œ
function calculateRanking() {
    // ê° ì‹œì„¤ ìœ í˜•ë³„ ìµœì†Œê°’ê³¼ ìµœëŒ€ê°’ ê³„ì‚° (ì •ê·œí™”ë¥¼ ìœ„í•´)
    let minMax = {
        hospital: { min: Number.MAX_VALUE, max: 0 },
        cafe: { min: Number.MAX_VALUE, max: 0 },
        park: { min: Number.MAX_VALUE, max: 0 }
    };
    
    // ìµœì†Œê°’/ìµœëŒ€ê°’ ì°¾ê¸°
    districtData.forEach(district => {
        minMax.hospital.min = Math.min(minMax.hospital.min, district.hospital);
        minMax.hospital.max = Math.max(minMax.hospital.max, district.hospital);
        
        minMax.cafe.min = Math.min(minMax.cafe.min, district.cafe);
        minMax.cafe.max = Math.max(minMax.cafe.max, district.cafe);
        
        minMax.park.min = Math.min(minMax.park.min, district.park);
        minMax.park.max = Math.max(minMax.park.max, district.park);
    });
    
    // 1ìˆœìœ„ë¡œ ì„¤ì •ëœ ì‹œì„¤ íƒ€ì… ì°¾ê¸°
    const firstPriorityType = Object.keys(weights).find(key => weights[key].priority === 1);
    const secondPriorityType = Object.keys(weights).find(key => weights[key].priority === 2);
    const thirdPriorityType = Object.keys(weights).find(key => weights[key].priority === 3);
    
    // ê° ë™ë„¤ë³„ ì ìˆ˜ ê³„ì‚° (ì •ê·œí™” ì ìš©)
    const scores = districtData.map(district => {
        // ì •ê·œí™”ëœ ê°’ ê³„ì‚° (ìµœì†Œê°’ì´ ìµœëŒ€ê°’ê³¼ ê°™ìœ¼ë©´ 0ìœ¼ë¡œ ì„¤ì •)
        let normalizedHospital = minMax.hospital.max === minMax.hospital.min ? 
            0 : (district.hospital - minMax.hospital.min) / (minMax.hospital.max - minMax.hospital.min);
            
        let normalizedCafe = minMax.cafe.max === minMax.cafe.min ? 
            0 : (district.cafe - minMax.cafe.min) / (minMax.cafe.max - minMax.cafe.min);
            
        let normalizedPark = minMax.park.max === minMax.park.min ? 
            0 : (district.park - minMax.park.min) / (minMax.park.max - minMax.park.min);
        
        // ì •ê·œí™”ëœ ê°’ì— ê°€ì¤‘ì¹˜ ì ìš©í•˜ì—¬ ì ìˆ˜ ê³„ì‚°
        const hospitalWeightedScore = normalizedHospital * weights.hospital.value;
        const cafeWeightedScore = normalizedCafe * weights.cafe.value;
        const parkWeightedScore = normalizedPark * weights.park.value;
        
        const score = hospitalWeightedScore + cafeWeightedScore + parkWeightedScore;
        
        // ì›ë˜ ê°’ê³¼ ì •ê·œí™”ëœ ê°’ì„ ëª¨ë‘ ì €ì¥
        return {
            district: district.district,
            rawScore: score, // ì •ë ¬ìš© ì›ì‹œ ì ìˆ˜
            score: score.toFixed(2), // í‘œì‹œìš© ì ìˆ˜ (ì†Œìˆ˜ì  2ìë¦¬)
            hospital: district.hospital,
            cafe: district.cafe,
            park: district.park,
            // ì •ê·œí™”ëœ ê°’ ì €ì¥
            normalizedHospital: normalizedHospital,
            normalizedCafe: normalizedCafe,
            normalizedPark: normalizedPark,
            // ê°€ì¤‘ì¹˜ ì ìš© ê°’ ì €ì¥
            hospitalWeightedScore: hospitalWeightedScore,
            cafeWeightedScore: cafeWeightedScore,
            parkWeightedScore: parkWeightedScore,
            // ìš°ì„ ìˆœìœ„ ì •ë³´ ì €ì¥
            firstPriorityType: firstPriorityType,
            secondPriorityType: secondPriorityType,
            thirdPriorityType: thirdPriorityType,
            // 1ìˆœìœ„ ì‹œì„¤ì˜ ì¡´ì¬ ì—¬ë¶€ í”Œë˜ê·¸ ì¶”ê°€
            hasFirstPriority: district[firstPriorityType] > 0
        };
    });
    
    // ìµœì†Œ ìš”êµ¬ì‚¬í•­ í•„í„°ë§: 1ìˆœìœ„ ì‹œì„¤ì´ ì—†ëŠ” ì§€ì—­ ì œì™¸
    const filteredScores = scores.filter(item => item.hasFirstPriority);
    
    // ì ìˆ˜ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ë©”ì‹œì§€ í‘œì‹œ
    if (filteredScores.length === 0) {
        document.getElementById('ranking-list').innerHTML = 
            '<li>1ìˆœìœ„ ì‹œì„¤ì„ ë³´ìœ í•œ ì§€ì—­ì´ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ìš°ì„ ìˆœìœ„ë¥¼ ì„ íƒí•´ë³´ì„¸ìš”.</li>';
        
        if (rankingChart) {
            rankingChart.destroy();
            rankingChart = null;
        }
        
        // ê³„ì‚° ê³¼ì • ì˜ì—­ ì´ˆê¸°í™”
        document.getElementById('calculation-explanation').innerHTML = '';
        return;
    }
    
    // ì ìˆ˜ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
    filteredScores.sort((a, b) => b.rawScore - a.rawScore);
    
    // Top 3ë§Œ ì¶”ì¶œ (ë˜ëŠ” ê°€ìš©í•œ ëª¨ë“  ì§€ì—­)
    const top3 = filteredScores.slice(0, Math.min(3, filteredScores.length));
    
    // ìˆœìœ„ ëª©ë¡ ì—…ë°ì´íŠ¸
    updateRankingList(top3);
    
    // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
    updateRankingChart(top3);
    
    // ê³„ì‚° ê³¼ì • ìƒì„¸ ì„¤ëª… ì—…ë°ì´íŠ¸
    updateCalculationExplanation(top3, minMax);
}

// ìˆœìœ„ ëª©ë¡ ì—…ë°ì´íŠ¸
function updateRankingList(topDistricts) {
    const rankingList = document.getElementById('ranking-list');
    rankingList.innerHTML = '';
    
    topDistricts.forEach((district, index) => {
        const listItem = document.createElement('li');
        listItem.innerHTML = `${index + 1}ìœ„: ${district.district} (ì ìˆ˜: ${district.score}, ë™ë¬¼ë³‘ì›: ${district.hospital}ê°œ, ì• ê²¬ì¹´í˜: ${district.cafe}ê°œ, ê³µì›: ${district.park}ê°œ)`;
        rankingList.appendChild(listItem);
    });
    
    // ê³„ì‚° ê³¼ì • ìƒì„¸ ì„¤ëª… ì—…ë°ì´íŠ¸
    updateCalculationExplanation(topDistricts);
}

// ê³„ì‚° ê³¼ì • ìƒì„¸ ì„¤ëª… ì—…ë°ì´íŠ¸
function updateCalculationExplanation(topDistricts, minMax) {
    const explanationList = document.getElementById('calculation-explanation');
    explanationList.innerHTML = '';
    
    // ìš°ì„ ìˆœìœ„ í‘œì‹œ í…Œì´ë¸” ìƒì„±
    const prioritySection = document.createElement('div');
    prioritySection.className = 'priority-info';
    prioritySection.innerHTML = '<h5>í˜„ì¬ ìš°ì„ ìˆœìœ„ ì„¤ì •</h5>';
    
    const priorityTable = document.createElement('table');
    priorityTable.className = 'priority-table';
    
    // í…Œì´ë¸” í—¤ë”
    const headerRow = document.createElement('tr');
    headerRow.innerHTML = '<th>ìˆœìœ„</th><th>ì‹œì„¤ ìœ í˜•</th><th>ê°€ì¤‘ì¹˜</th>';
    priorityTable.appendChild(headerRow);
    
    // ê° ìš°ì„ ìˆœìœ„ë³„ ì‹œì„¤ ë° ê°€ì¤‘ì¹˜ í‘œì‹œ
    const firstDistrict = topDistricts[0]; // í•˜ë‚˜ì˜ ì§€ì—­ì—ì„œ ìš°ì„ ìˆœìœ„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    
    const priorities = [
        { type: firstDistrict.firstPriorityType, rank: 1, weight: weights[firstDistrict.firstPriorityType].value },
        { type: firstDistrict.secondPriorityType, rank: 2, weight: weights[firstDistrict.secondPriorityType].value },
        { type: firstDistrict.thirdPriorityType, rank: 3, weight: weights[firstDistrict.thirdPriorityType].value }
    ];
    
    // ì‹œì„¤ ì´ë¦„ í•œê¸€í™”
    const facilityNames = {
        hospital: 'ë™ë¬¼ë³‘ì›',
        cafe: 'ì• ê²¬ì¹´í˜',
        park: 'ê³µì›'
    };
    
    // ìš°ì„ ìˆœìœ„ í–‰ ìƒì„±
    priorities.forEach(priority => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${priority.rank}ìˆœìœ„</td><td>${facilityNames[priority.type]}</td><td>${priority.weight}</td>`;
        priorityTable.appendChild(row);
    });
    
    prioritySection.appendChild(priorityTable);
    explanationList.appendChild(prioritySection);
    
    // êµ¬ë¶„ì„  ì¶”ê°€
    const divider = document.createElement('hr');
    explanationList.appendChild(divider);
    
    // ê° ë™ë„¤ë³„ ê³„ì‚° ê³¼ì • í‘œì‹œ
    topDistricts.forEach((district, index) => {
        const districtSection = document.createElement('div');
        districtSection.className = 'district-calculation';
        
        const header = document.createElement('h5');
        header.innerHTML = `${index + 1}ìœ„: ${district.district} (ìµœì¢… ì ìˆ˜: ${district.score})`;
        districtSection.appendChild(header);
        
        // ê³„ì‚° í…Œì´ë¸” ìƒì„±
        const calcTable = document.createElement('table');
        calcTable.className = 'calculation-table';
        
        // í…Œì´ë¸” í—¤ë”
        const calcHeaderRow = document.createElement('tr');
        calcHeaderRow.innerHTML = '<th>ì‹œì„¤ ìœ í˜•</th><th>ì‹œì„¤ ìˆ˜</th><th>ì •ê·œí™” ê°’</th><th>ìš°ì„ ìˆœìœ„</th><th>ê°€ì¤‘ì¹˜</th><th>ê°€ì¤‘ì¹˜ ì ìš© ì ìˆ˜</th>';
        calcTable.appendChild(calcHeaderRow);
        
        // ê° ì‹œì„¤ ìœ í˜•ë³„ ê³„ì‚° í–‰ ìƒì„±
        const facilityTypes = ['ë™ë¬¼ë³‘ì›', 'ì• ê²¬ì¹´í˜', 'ê³µì›'];
        const facilityKeys = ['hospital', 'cafe', 'park'];
        
        facilityKeys.forEach((key, i) => {
            const row = document.createElement('tr');
            
            // ìš°ì„ ìˆœìœ„ í™•ì¸
            let priorityRank = 0;
            if (district.firstPriorityType === key) priorityRank = 1;
            else if (district.secondPriorityType === key) priorityRank = 2;
            else if (district.thirdPriorityType === key) priorityRank = 3;
            
            row.innerHTML = `
                <td>${facilityTypes[i]}</td>
                <td>${district[key]}</td>
                <td>${district['normalized'+key.charAt(0).toUpperCase()+key.slice(1)].toFixed(2)}</td>
                <td>${priorityRank}ìˆœìœ„</td>
                <td>${weights[key].value}</td>
                <td>${district[key+'WeightedScore'].toFixed(2)}</td>
            `;
            calcTable.appendChild(row);
        });
        
        // ì´ê³„ í–‰ ì¶”ê°€
        const totalRow = document.createElement('tr');
        totalRow.className = 'total-row';
        totalRow.innerHTML = `
            <td colspan="5" class="total-label">ì´ê³„ ì ìˆ˜</td>
            <td class="total-value">${district.score}</td>
        `;
        calcTable.appendChild(totalRow);
        
        districtSection.appendChild(calcTable);
        explanationList.appendChild(districtSection);
        
        // ë™ë„¤ êµ¬ë¶„ì„  ì¶”ê°€ (ë§ˆì§€ë§‰ ë™ë„¤ ì œì™¸)
        if (index < topDistricts.length - 1) {
            const districtDivider = document.createElement('hr');
            explanationList.appendChild(districtDivider);
        }
    });
}

// ìˆœìœ„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
function updateRankingChart(topDistricts) {
    const ctx = document.getElementById('ranking-chart').getContext('2d');
    
    // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆìœ¼ë©´ ì œê±°
    if (rankingChart) {
        rankingChart.destroy();
    }
    
    // ìƒˆë¡œìš´ ì°¨íŠ¸ ìƒì„±
    rankingChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: topDistricts.map(d => d.district),
            datasets: [{
                label: 'ì¢…í•© ì ìˆ˜',
                data: topDistricts.map(d => d.score),
                backgroundColor: [
                    'rgba(255, 159, 64, 0.7)',  // 1ìœ„ - ì£¼í™©ìƒ‰
                    'rgba(75, 192, 192, 0.7)',  // 2ìœ„ - ì²­ë¡ìƒ‰
                    'rgba(153, 102, 255, 0.7)'  // 3ìœ„ - ë³´ë¼ìƒ‰
                ],
                borderColor: [
                    'rgb(255, 159, 64)',
                    'rgb(75, 192, 192)',
                    'rgb(153, 102, 255)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'ìš°ë¦¬ì§‘ ê°•ì•„ì§€ì—ê²Œ ì¢‹ì€ ë™ë„¤ TOP 3',
                    font: {
                        size: 16
                    }
                },
                tooltip: {
                    callbacks: {
                        afterLabel: function(context) {
                            const district = topDistricts[context.dataIndex];
                            return [
                                `ë™ë¬¼ë³‘ì›: ${district.hospital}ê°œ`,
                                `ì• ê²¬ì¹´í˜: ${district.cafe}ê°œ`,
                                `ê³µì›: ${district.park}ê°œ`
                            ];
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'ì¢…í•© ì ìˆ˜'
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: 'í–‰ì •ë™'
                    }
                }
            }
        }
    });
}
</script>
            padding: 0.8rem;
            background: #f9f9fb;
            border-radius: 6px;
        }
        .legend h4 {
            margin-top: 0;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.4rem;
        }
        .marker {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .red { background-color: red; }
        .blue { background-color: blue; }
        .green { background-color: green; }
        h3 {
            color: #1f2937;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 0.5rem;
            margin-top: 0;
        }
    
<h3>ğŸ“Š ì‹œì„¤ë³„ ìƒìœ„ í–‰ì •ë™</h3>
<div class="facilities-tables">
<div class="facility-table">
<h4>ğŸ¥ ë™ë¬¼ë³‘ì› TOP 5</h4>
<table class="rank-table">
<thead>
<tr>
<th>ìˆœìœ„</th>
<th>í–‰ì •ë™</th>
<th>ê°œìˆ˜</th>
</tr>
</thead>
<tbody>
<tr class="first-rank">
<td>1</td>
<td>ì¢Œ2ë™</td>
<td>17</td>
</tr>
<tr class="">
<td>2</td>
<td>ì–‘ì •1ë™</td>
<td>14</td>
</tr>
<tr class="">
<td>3</td>
<td>êµ¬ì„œ1ë™</td>
<td>11</td>
</tr>
<tr class="">
<td>4</td>
<td>ìš°3ë™</td>
<td>11</td>
</tr>
<tr class="">
<td>5</td>
<td>ì¤‘1ë™</td>
<td>11</td>
</tr>
</tbody>
</table>
</div>
<div class="facility-table">
<h4>â˜• ì• ê²¬ì¹´í˜ TOP 5</h4>
<table class="rank-table">
<thead>
<tr>
<th>ìˆœìœ„</th>
<th>í–‰ì •ë™</th>
<th>ê°œìˆ˜</th>
</tr>
</thead>
<tbody>
<tr class="first-rank">
<td>1</td>
<td>ë¯¼ë½ë™</td>
<td>4</td>
</tr>
<tr class="">
<td>2</td>
<td>ì •ê´€ì</td>
<td>3</td>
</tr>
<tr class="">
<td>3</td>
<td>ëª…ì§€1ë™</td>
<td>3</td>
</tr>
<tr class="">
<td>4</td>
<td>ë¶€ì „2ë™</td>
<td>3</td>
</tr>
<tr class="">
<td>5</td>
<td>ë‹¤ëŒ€2ë™</td>
<td>3</td>
</tr>
</tbody>
</table>
</div>
<div class="facility-table">
<h4>ğŸŒ³ ê³µì› TOP 5</h4>
<table class="rank-table">
<thead>
<tr>
<th>ìˆœìœ„</th>
<th>í–‰ì •ë™</th>
<th>ê°œìˆ˜</th>
</tr>
</thead>
<tbody>
<tr class="first-rank">
<td>1</td>
<td>ë…¹ì‚°ë™</td>
<td>89</td>
</tr>
<tr class="">
<td>2</td>
<td>ì‚¼ë½ë™</td>
<td>74</td>
</tr>
<tr class="">
<td>3</td>
<td>ì •ê´€ì</td>
<td>67</td>
</tr>
<tr class="">
<td>4</td>
<td>ê¸°ì¥ì</td>
<td>64</td>
</tr>
<tr class="">
<td>5</td>
<td>ë¶€ì „1ë™</td>
<td>54</td>
</tr>
</tbody>
</table>
</div>
</div><h3>ğŸ”¬ í´ëŸ¬ìŠ¤í„°ë§ ë¶„ì„</h3><div class="clustering-section">
<div class="clustering-info">
<p>ë¶€ì‚°ì‹œ í–‰ì •ë™ì„ ë°˜ë ¤ê²¬ ì‹œì„¤ íŠ¹ì„±ì— ë”°ë¼ 5ê°œ í´ëŸ¬ìŠ¤í„°ë¡œ ë¶„ë¥˜í–ˆìŠµë‹ˆë‹¤.</p>
</div>
<div class="cluster-groups">
<div class="cluster-group" style="border-left: 4px solid #FF5733;">
<div class="cluster-header">
<h4 style="color: #FF5733;">ğŸ¢ ì¢…í•© ì¸í”„ë¼í˜• (8ê°œ ë™ë„¤)</h4>
<p class="cluster-desc">ë™ë¬¼ë³‘ì›, ì• ê²¬ì¹´í˜, ê³µì›ì´ ëª¨ë‘ ì˜ ê°–ì¶°ì§„ ì§€ì—­</p>
</div>
<div class="cluster-stats">
<span class="stat-item">ğŸ¥ ë™ë¬¼ë³‘ì›: 6.5ê°œ</span>
<span class="stat-item">â˜• ì• ê²¬ì¹´í˜: 2.1ê°œ</span>
<span class="stat-item">ğŸŒ³ ê³µì›: 14.2ê°œ</span>
</div>
<div class="cluster-districts">
<span class="district-tag">ì¢Œ2ë™</span>
<span class="district-tag">ëª…ì§€1ë™</span>
<span class="district-tag">ë¯¼ë½ë™</span>
<span class="district-tag">ì •ê´€ì</span>
<span class="district-tag">ì¼ê´‘ì</span>
<span class="district-tag">ëŒ€ì—°3ë™</span>
<span class="district-tag">í™”ëª…3ë™</span>
<span class="district-tag">ë‹¤ëŒ€1ë™</span>
</div>
</div>
<div class="cluster-group" style="border-left: 4px solid #33FF57;">
<div class="cluster-header">
<h4 style="color: #33FF57;">ğŸ¥ ì˜ë£Œ ì¤‘ì‹¬í˜• (40ê°œ ë™ë„¤)</h4>
<p class="cluster-desc">ë™ë¬¼ë³‘ì›ì´ ë§ì´ ì§‘ì¤‘ëœ ì§€ì—­</p>
</div>
<div class="cluster-stats">
<span class="stat-item">ğŸ¥ ë™ë¬¼ë³‘ì›: 5.8ê°œ</span>
<span class="stat-item">â˜• ì• ê²¬ì¹´í˜: 0.3ê°œ</span>
<span class="stat-item">ğŸŒ³ ê³µì›: 6.8ê°œ</span>
</div>
<div class="cluster-districts">
<span class="district-tag">ì–‘ì •1ë™</span>
<span class="district-tag">êµ¬ì„œ1ë™</span>
<span class="district-tag">ì¤‘1ë™</span>
<span class="district-tag">ìš°3ë™</span>
<span class="district-tag">ì¥ì „2ë™</span>
<span class="district-tag">ë‚¨ì²œ1ë™</span>
<span class="district-tag">ì¢Œ1ë™</span>
<span class="district-tag">ë‚¨í¬ë™</span>
<span class="district-tag-more">ì™¸ 32ê°œ ë™ë„¤</span>
</div>
</div>
<div class="cluster-group" style="border-left: 4px solid #3357FF;">
<div class="cluster-header">
<h4 style="color: #3357FF;">ğŸŒ³ ì—¬ê°€ ì¤‘ì‹¬í˜• (18ê°œ ë™ë„¤)</h4>
<p class="cluster-desc">ê³µì›ì´ ë§ì•„ ì‚°ì±…í•˜ê¸° ì¢‹ì€ ì§€ì—­</p>
</div>
<div class="cluster-stats">
<span class="stat-item">ğŸ¥ ë™ë¬¼ë³‘ì›: 1.7ê°œ</span>
<span class="stat-item">â˜• ì• ê²¬ì¹´í˜: 0.8ê°œ</span>
<span class="stat-item">ğŸŒ³ ê³µì›: 9.6ê°œ</span>
</div>
<div class="cluster-districts">
<span class="district-tag">ë‹¤ëŒ€2ë™</span>
<span class="district-tag">ì „í¬1ë™</span>
<span class="district-tag">ë‹¹ë¦¬ë™</span>
<span class="district-tag">ì¥ì•ˆì</span>
<span class="district-tag">í™”ëª…2ë™</span>
<span class="district-tag">ì—„ê¶ë™</span>
<span class="district-tag">ìˆ˜ì˜ë™</span>
<span class="district-tag">ë•ì²œ1ë™</span>
<span class="district-tag-more">ì™¸ 10ê°œ ë™ë„¤</span>
</div>
</div>
<div class="cluster-group" style="border-left: 4px solid #FF33A8;">
<div class="cluster-header">
<h4 style="color: #FF33A8;">â˜• ì¹´í˜ ë¬¸í™”í˜• (18ê°œ ë™ë„¤)</h4>
<p class="cluster-desc">ì• ê²¬ì¹´í˜ê°€ ë°œë‹¬í•œ ë¬¸í™”ì  ì§€ì—­</p>
</div>
<div class="cluster-stats">
<span class="stat-item">ğŸ¥ ë™ë¬¼ë³‘ì›: 1.1ê°œ</span>
<span class="stat-item">â˜• ì• ê²¬ì¹´í˜: 1.4ê°œ</span>
<span class="stat-item">ğŸŒ³ ê³µì›: 2.1ê°œ</span>
</div>
<div class="cluster-districts">
<span class="district-tag">ë¶€ì „2ë™</span>
<span class="district-tag">ì•ˆë½2ë™</span>
<span class="district-tag">ê´˜ë²•ë™</span>
<span class="district-tag">ì¤‘2ë™</span>
<span class="district-tag">êµ¬í¬1ë™</span>
<span class="district-tag">ë¶€ê³¡2ë™</span>
<span class="district-tag">ì—°ì‚°4ë™</span>
<span class="district-tag">ê±°ì œ3ë™</span>
<span class="district-tag-more">ì™¸ 10ê°œ ë™ë„¤</span>
</div>
</div>
<div class="cluster-group" style="border-left: 4px solid #FFD700;">
<div class="cluster-header">
<h4 style="color: #FFD700;">ğŸ˜ï¸ ê¸°ë³¸ ì¸í”„ë¼í˜• (66ê°œ ë™ë„¤)</h4>
<p class="cluster-desc">ê¸°ë³¸ì ì¸ ì‹œì„¤ë§Œ ê°–ì¶˜ ì¼ë°˜ ì£¼ê±°ì§€ì—­</p>
</div>
<div class="cluster-stats">
<span class="stat-item">ğŸ¥ ë™ë¬¼ë³‘ì›: 1.7ê°œ</span>
<span class="stat-item">â˜• ì• ê²¬ì¹´í˜: 0.0ê°œ</span>
<span class="stat-item">ğŸŒ³ ê³µì›: 2.2ê°œ</span>
</div>
<div class="cluster-districts">
<span class="district-tag">ë‹¹ê°4ë™</span>
<span class="district-tag">ê°€ì•¼2ë™</span>
<span class="district-tag">í•˜ë‹¨1ë™</span>
<span class="district-tag">ì‚¬ì§1ë™</span>
<span class="district-tag">êµ¬í¬2ë™</span>
<span class="district-tag">ì•ˆë½1ë™</span>
<span class="district-tag">ì—°ì‚°6ë™</span>
<span class="district-tag">ë¬¸í˜„2ë™</span>
<span class="district-tag-more">ì™¸ 58ê°œ ë™ë„¤</span>
</div>
</div>
</div>
</div><style>
        .clustering-section {
            margin: 2rem 0;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .clustering-info {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .clustering-info p {
            font-size: 1.1rem;
            color: #495057;
            margin: 0;
        }
        
        .cluster-groups {
            display: grid;
            gap: 1.5rem;
        }
        
        .cluster-group {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }
        
        .cluster-group:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .cluster-header h4 {
            margin: 0 0 0.5rem 0;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .cluster-desc {
            color: #6c757d;
            margin: 0 0 1rem 0;
            font-size: 0.9rem;
        }
        
        .cluster-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .stat-item {
            background: #e9ecef;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .cluster-districts {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .district-tag {
            background: #f1f3f4;
            color: #495057;
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
            font-size: 0.8rem;
            border: 1px solid #dee2e6;
        }
        
        .district-tag-more {
            background: #007bff;
            color: white;
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        @media (max-width: 768px) {
            .cluster-stats {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .stat-item {
                text-align: center;
            }
        }
    </style>

<!-- í´ëŸ¬ìŠ¤í„°ë§ ë¶„ì„ ì„¹ì…˜ ì¶”ê°€ -->
<h3>ğŸ”¬ í´ëŸ¬ìŠ¤í„°ë§ ë¶„ì„</h3>
<div class="clustering-section">
<div class="clustering-info">
<p>ë¶€ì‚°ì‹œ í–‰ì •ë™ì„ ë°˜ë ¤ê²¬ ì‹œì„¤ íŠ¹ì„±ì— ë”°ë¼ 5ê°œ í´ëŸ¬ìŠ¤í„°ë¡œ ë¶„ë¥˜í–ˆìŠµë‹ˆë‹¤.</p>
</div>
<div class="cluster-groups">
<div class="cluster-group" style="border-left: 4px solid #FF5733;">
<div class="cluster-header">
<h4 style="color: #FF5733;">ğŸ¢ ì¢…í•© ì¸í”„ë¼í˜• (8ê°œ ë™ë„¤)</h4>
<p class="cluster-desc">ë™ë¬¼ë³‘ì›, ì• ê²¬ì¹´í˜, ê³µì›ì´ ëª¨ë‘ ì˜ ê°–ì¶°ì§„ ì§€ì—­</p>
</div>
<div class="cluster-stats">
<span class="stat-item">ğŸ¥ ë™ë¬¼ë³‘ì›: 6.5ê°œ</span>
<span class="stat-item">â˜• ì• ê²¬ì¹´í˜: 2.1ê°œ</span>
<span class="stat-item">ğŸŒ³ ê³µì›: 14.2ê°œ</span>
</div>
<div class="cluster-districts">
<span class="district-tag">ì¢Œ2ë™</span>
<span class="district-tag">ëª…ì§€1ë™</span>
<span class="district-tag">ë¯¼ë½ë™</span>
<span class="district-tag">ì •ê´€ì</span>
<span class="district-tag">ê°œê¸ˆ3ë™</span>
<span class="district-tag">ê¸°ì¥ì</span>
<span class="district-tag">ë¶€ì „1ë™</span>
<span class="district-tag">ì„œ1ë™</span>
</div>
</div>
<div class="cluster-group" style="border-left: 4px solid #33FF57;">
<div class="cluster-header">
<h4 style="color: #33FF57;">ğŸ¥ ì˜ë£Œ ì¤‘ì‹¬í˜• (40ê°œ ë™ë„¤)</h4>
<p class="cluster-desc">ë™ë¬¼ë³‘ì›ì´ ë§ì´ ì§‘ì¤‘ëœ ì§€ì—­</p>
</div>
<div class="cluster-stats">
<span class="stat-item">ğŸ¥ ë™ë¬¼ë³‘ì›: 5.8ê°œ</span>
<span class="stat-item">â˜• ì• ê²¬ì¹´í˜: 0.3ê°œ</span>
<span class="stat-item">ğŸŒ³ ê³µì›: 6.8ê°œ</span>
</div>
<div class="cluster-districts">
<span class="district-tag">ì–‘ì •1ë™</span>
<span class="district-tag">êµ¬ì„œ1ë™</span>
<span class="district-tag">ì¤‘1ë™</span>
<span class="district-tag">ìš°3ë™</span>
<span class="district-tag">ì¥ì „2ë™</span>
<span class="district-tag">ë‚¨ì²œ1ë™</span>
<span class="district-tag">ì¢Œ1ë™</span>
<span class="district-tag">ë‚¨í¬ë™</span>
<span class="district-tag-more">ì™¸ 32ê°œ ë™ë„¤</span>
</div>
</div>
<div class="cluster-group" style="border-left: 4px solid #3357FF;">
<div class="cluster-header">
<h4 style="color: #3357FF;">ğŸŒ³ ì—¬ê°€ ì¤‘ì‹¬í˜• (18ê°œ ë™ë„¤)</h4>
<p class="cluster-desc">ê³µì›ì´ ë§ì•„ ì‚°ì±…í•˜ê¸° ì¢‹ì€ ì§€ì—­</p>
</div>
<div class="cluster-stats">
<span class="stat-item">ğŸ¥ ë™ë¬¼ë³‘ì›: 1.7ê°œ</span>
<span class="stat-item">â˜• ì• ê²¬ì¹´í˜: 0.8ê°œ</span>
<span class="stat-item">ğŸŒ³ ê³µì›: 9.6ê°œ</span>
</div>
<div class="cluster-districts">
<span class="district-tag">ê°ì „ë™</span>
<span class="district-tag">ê°œê¸ˆ1ë™</span>
<span class="district-tag">êµ¬í¬1ë™</span>
<span class="district-tag">ê¸ˆê³¡ë™</span>
<span class="district-tag">ë‹¹ë¦¬ë™</span>
<span class="district-tag">ë™ì‚¼1ë™</span>
<span class="district-tag">ë§Œë•1ë™</span>
<span class="district-tag">ë°˜ì—¬1ë™</span>
<span class="district-tag-more">ì™¸ 10ê°œ ë™ë„¤</span>
</div>
</div>
<div class="cluster-group" style="border-left: 4px solid #FF33A8;">
<div class="cluster-header">
<h4 style="color: #FF33A8;">â˜• ì¹´í˜ ë¬¸í™”í˜• (18ê°œ ë™ë„¤)</h4>
<p class="cluster-desc">ì• ê²¬ì¹´í˜ê°€ ë°œë‹¬í•œ ë¬¸í™”ì  ì§€ì—­</p>
</div>
<div class="cluster-stats">
<span class="stat-item">ğŸ¥ ë™ë¬¼ë³‘ì›: 1.1ê°œ</span>
<span class="stat-item">â˜• ì• ê²¬ì¹´í˜: 1.4ê°œ</span>
<span class="stat-item">ğŸŒ³ ê³µì›: 2.1ê°œ</span>
</div>
<div class="cluster-districts">
<span class="district-tag">ê°€ë½ë³¸ë™</span>
<span class="district-tag">ê±°ì œ2ë™</span>
<span class="district-tag">ê´´ì •2ë™</span>
<span class="district-tag">ê¸ˆì‚¬íšŒë™ë™</span>
<span class="district-tag">ë‚¨êµ¬ì²­</span>
<span class="district-tag">ëŒ€ì—°3ë™</span>
<span class="district-tag">ë™ë˜ì</span>
<span class="district-tag">ë¶€ì „2ë™</span>
<span class="district-tag-more">ì™¸ 10ê°œ ë™ë„¤</span>
</div>
</div>
<div class="cluster-group" style="border-left: 4px solid #FFD700;">
<div class="cluster-header">
<h4 style="color: #FFD700;">ğŸ˜ï¸ ê¸°ë³¸ ì¸í”„ë¼í˜• (66ê°œ ë™ë„¤)</h4>
<p class="cluster-desc">ê¸°ë³¸ì ì¸ ì‹œì„¤ë§Œ ê°–ì¶˜ ì¼ë°˜ ì£¼ê±°ì§€ì—­</p>
</div>
<div class="cluster-stats">
<span class="stat-item">ğŸ¥ ë™ë¬¼ë³‘ì›: 1.7ê°œ</span>
<span class="stat-item">â˜• ì• ê²¬ì¹´í˜: 0.0ê°œ</span>
<span class="stat-item">ğŸŒ³ ê³µì›: 2.2ê°œ</span>
</div>
<div class="cluster-districts">
<span class="district-tag">ê°€ë•ë„ë™</span>
<span class="district-tag">ê°•ì„œ1ë™</span>
<span class="district-tag">ê°•ì„œ2ë™</span>
<span class="district-tag">ê°œê¸ˆ2ë™</span>
<span class="district-tag">ê±°ì œ1ë™</span>
<span class="district-tag">ê±°ì œ3ë™</span>
<span class="district-tag">ê±°ì œ4ë™</span>
<span class="district-tag">ê´´ì •1ë™</span>
<span class="district-tag-more">ì™¸ 58ê°œ ë™ë„¤</span>
</div>
</div>
</div>
</div>
<style>
    .clustering-section {
        margin: 2rem 0;
        padding: 1.5rem;
        background: #f8f9fa;
        border-radius: 10px;
    }
    
    .clustering-info {
        text-align: center;
        margin-bottom: 2rem;
    }
    
    .clustering-info p {
        font-size: 1.1rem;
        color: #495057;
        margin: 0;
    }
    
    .cluster-groups {
        display: grid;
        gap: 1.5rem;
    }
    
    .cluster-group {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: transform 0.2s ease;
    }
    
    .cluster-group:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .cluster-header h4 {
        margin: 0 0 0.5rem 0;
        font-size: 1.2rem;
        font-weight: 600;
    }
    
    .cluster-desc {
        color: #6c757d;
        margin: 0 0 1rem 0;
        font-size: 0.9rem;
    }
    
    .cluster-stats {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
        flex-wrap: wrap;
    }
    
    .stat-item {
        background: #e9ecef;
        padding: 0.3rem 0.8rem;
        border-radius: 15px;
        font-size: 0.85rem;
        font-weight: 500;
    }
    
    .cluster-districts {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    
    .district-tag {
        background: #f1f3f4;
        color: #495057;
        padding: 0.25rem 0.6rem;
        border-radius: 12px;
        font-size: 0.8rem;
        border: 1px solid #dee2e6;
    }
    
    .district-tag-more {
        background: #007bff;
        color: white;
        padding: 0.25rem 0.6rem;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 500;
    }
    
    @media (max-width: 768px) {
        .cluster-stats {
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .stat-item {
            text-align: center;
        }
    }
</style>


<!-- Kakao ì¥ì†Œ í•„í„°ë§ì„ ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ -->
<script>
    // ê±¸ì„ ìˆ˜ ìˆëŠ” ì¥ì†Œ ì¹´í…Œê³ ë¦¬
    const FILTER_CATEGORIES = [
      'ë„ë³´ì—¬í–‰',
      'ë‘˜ë ˆê¸¸',
      'í•˜ì²œ',
      'ê³µì›',
      'ì‚°ì±…ë¡œ',
      'ì‚°ì±…ê¸¸',
      'ì‚°',
      'ë“±ì‚°',
      'ë™ì‚°',
      'ìˆ˜ëª©ì›',
      'ìƒíƒœê³µì›',
      'ìì—°ê³µì›',
      'ë§ˆì„ê³µì›',
      'ê°•ë³€ê³µì›',
    ];

    // ê³µì›ìœ¼ë¡œ ê°„ì£¼ë˜ëŠ” ì¹´í…Œê³ ë¦¬ í‚¤ì›Œë“œ
    const PARK_KEYWORDS = [
      'ê³µì›',
      'ìˆ˜ëª©ì›',
      'ìƒíƒœê³µì›',
      'ìì—°ê³µì›',
      'ë§ˆì„ê³µì›',
    ];

    // ê³µì›ìœ¼ë¡œ í•„í„°ë§ í•  ë•Œ ì œì™¸í•  ì¥ì†Œ í‚¤ì›Œë“œ
    const PARK_EXCLUSION_KEYWORDS = [
      'í™”ì¥ì‹¤',
      'ì£¼ì°¨ì¥',
      'ê´€ë¦¬ì†Œ',
      'ë§¤í‘œì†Œ',
      'ì‚¬ë¬´ì†Œ',
      'ì„¼í„°',
      'ì•ˆë‚´ì†Œ',
      'ê´€ë¦¬ì‹¤',
      'ê´€ë¦¬ë‹¨',
      'ê´€ê´‘ì•ˆë‚´ì†Œ',
    ];

    /**
     * ì¹´í…Œê³ ë¦¬ ê¸°ë°˜ ì¥ì†Œ í•„í„°ë§
     * @param {Array} places - ì¹´ì¹´ì˜¤ ì¥ì†Œ ê²€ìƒ‰ ê²°ê³¼
     * @returns {Array} - í•„í„°ë§ëœ ì¥ì†Œ ëª©ë¡
     */
    function filterPlacesByCategory(places) {
      return places.filter((place) => {
        const categories = place.category_name.split(` > `);
        return FILTER_CATEGORIES.some((keyword) => categories.includes(keyword));
      });
    }

    /**
     * ì—„ê²©í•œ í•„í„°ë§ - ì—¬í–‰ > ê´€ê´‘,ëª…ì†Œ ì¹´í…Œê³ ë¦¬ì— ì†í•œ ì¥ì†Œë§Œ í•„í„°ë§
     * @param {Array} places - ì¹´ì¹´ì˜¤ ì¥ì†Œ ê²€ìƒ‰ ê²°ê³¼
     * @returns {Array} - í•„í„°ë§ëœ ì¥ì†Œ ëª©ë¡
     */
    function filterPlacesStrict(places) {
      return places.filter((place) => {
        const categories = place.category_name.split(` > `);
        // ì—¬í–‰ > ê´€ê´‘,ëª…ì†Œ ì¹´í…Œê³ ë¦¬ì— ì†í•˜ëŠ”ì§€ í™•ì¸
        const isValidPath =
          categories[0] === 'ì—¬í–‰' && categories[1] === 'ê´€ê´‘,ëª…ì†Œ';
        if (!isValidPath) return false;

        // í•„í„°ë§ ì¹´í…Œê³ ë¦¬ì— ì†í•˜ëŠ”ì§€ í™•ì¸
        return FILTER_CATEGORIES.some((keyword) => categories.includes(keyword));
      });
    }

    /**
     * ê³µì›ë§Œ í•„í„°ë§í•˜ê³  ë¶ˆí•„ìš”í•œ ì¥ì†Œ(í™”ì¥ì‹¤, ì£¼ì°¨ì¥ ë“±) ì œì™¸
     * @param {Array} places - ì¹´ì¹´ì˜¤ ì¥ì†Œ ê²€ìƒ‰ ê²°ê³¼
     * @returns {Array} - í•„í„°ë§ëœ ì¥ì†Œ ëª©ë¡
     */
    function filterParkOnly(places) {
      return places.filter((place) => {
        const categories = place.category_name.split(` > `);
        const placeName = place.place_name || '';
        
        // ê³µì› í‚¤ì›Œë“œë¥¼ í¬í•¨í•˜ëŠ”ì§€ í™•ì¸
        const isPark = PARK_KEYWORDS.some((keyword) =>
          categories.includes(keyword) || placeName.includes(keyword)
        );
        
        if (!isPark) return false;
        
        // ì œì™¸í•  í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
        const hasExclusionKeyword = PARK_EXCLUSION_KEYWORDS.some((keyword) =>
          placeName.includes(keyword)
        );
        
        return isPark && !hasExclusionKeyword;
      });
    }

    /**
     * ì¹´ì¹´ì˜¤ í‚¤ì›Œë“œ ê²€ìƒ‰ ìˆ˜í–‰ í›„ ê²°ê³¼ í•„í„°ë§
     * @param {Object} placesService - ì¹´ì¹´ì˜¤ ì¥ì†Œ ê²€ìƒ‰ ì„œë¹„ìŠ¤ ê°ì²´
     * @param {string} keyword - ê²€ìƒ‰ í‚¤ì›Œë“œ
     * @param {function} callback - ê²°ê³¼ë¥¼ ì²˜ë¦¬í•  ì½œë°± í•¨ìˆ˜
     * @param {function} filterFn - í•„í„°ë§ í•¨ìˆ˜ (ê¸°ë³¸ê°’: filterParkOnly)
     */
    function searchAndFilterPlaces(
      placesService,
      keyword,
      callback,
      filterFn = filterParkOnly
    ) {
      placesService.keywordSearch(keyword, (result, status) => {
        if (status === kakao.maps.services.Status.OK) {
          // ê²°ê³¼ í•„í„°ë§
          const filteredPlaces = filterFn(result);
          callback(filteredPlaces);
        } else {
          callback([]);
        }
      });
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰: ì´ HTMLì´ ì •ì  ë°ì´í„°ë§Œ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì— 
    // í•„í„°ë§ì„ ì ìš©í•  í›„ì† êµ¬í˜„ì„ ìœ„í•œ ì‹œì‘ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ì¹´ì¹´ì˜¤ ì¥ì†Œ í•„í„°ë§ ê¸°ëŠ¥ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.');
      console.log('filterParkOnly, filterPlacesByCategory, filterPlacesStrict í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      console.log('searchAndFilterPlaces í•¨ìˆ˜ë¥¼ í†µí•´ ê²€ìƒ‰ê³¼ í•„í„°ë§ì„ í•œ ë²ˆì— ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
    });
  </script>
</body>
</html>
