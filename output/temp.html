<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>부산에서 강아지 키우기 좋은 동네</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0px 32px 32px 32px;
        font-family: "Noto Sans KR", Arial, sans-serif;
        background: #f7f7fa;
        overflow-x: hidden;
      }

      /* 수직 여백 추가 */
      .container {
        margin: 40px 0;
        display: flex;
        flex-direction: row;
        width: 100%;
        height: calc(100vh - 77px);
        min-height: 500px;
      }
      
      .left-map {
        margin-top: 16px;
        margin-bottom: 16px;
        width: 50%;
        min-width: 320px;
        height: 100%;
        margin-right: 24px; /* Add margin between columns */
      }
      
      .right-panel {
        margin-top: 16px;
        margin-bottom: 16px;
        width: 50%;
        min-width: 320px;
        height: 100%;
        display: flex;
        flex-direction: column;
        background: #f7f7fa;
      }
      
      .custom-recommendation {
        margin-top: 16px;
        margin-bottom: 16px;
        background-color: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin-bottom: 20px;
      }
      
      .facility-table {
        margin-top: 16px;
        margin-bottom: 16px;
      }
      
      .ranking-container {
        margin-top: 20px;
        margin-bottom: 16px;
      }
      
      .explanation {
        margin-top: 20px;
        color: #4a5568;
        font-size: 0.95em;
        background-color: #f8f9ff;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #4285f4;
      }

      .explanation h4 {
        color: #2d3748;
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 1.1em;
      }

      .explanation h5 {
        color: #4a5568;
        margin: 15px 0 5px 0;
        font-size: 1em;
        font-weight: 600;
      }

      .explanation p {
        margin: 5px 0;
        line-height: 1.5;
      }

      .explanation ul.guide-list {
        margin: 5px 0 15px 20px;
        padding: 0;
        font-size: 0.9em;
      }

      .explanation ul.guide-list li {
        margin-bottom: 5px;
      }

      .explanation small {
        display: block;
        margin-bottom: 5px;
      }

      .small-note {
        margin-top: 10px;
        font-style: italic;
        color: #718096;
        font-size: 0.9em;
      }

      .header {
        width: 100vw;
        margin-left: calc(-1 * (32px));
        margin-right: calc(-1 * (32px));
        background: #3b82f6;
        color: #fff;
        font-size: 2rem;
        font-weight: bold;
        text-align: center;
        padding: 1.5rem 0 1.2rem 0;
        letter-spacing: -1px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      }
      
      .map-iframe {
        width: 100%;
        height: 100%;
        border: none;
        display: block;
      }
      
      .right-top,
      .right-bottom {
        flex: 1;
        padding: 0;
        border-bottom: 1px solid #e5e7eb;
        background: #fff;
        overflow-y: auto;
      }
      
      .right-bottom {
        border-bottom: none;
        background: #f0f6ff;
      }
      
      /* 우선순위 선택 스타일 */
      .priority-selection {
        margin: 20px 0;
      }
      
      .priority-group {
        margin-bottom: 15px;
      }
      
      .priority-group h4 {
        margin: 5px 0;
        font-size: 1rem;
        color: #334155;
      }
      
      .priority-buttons {
        display: flex;
        gap: 8px;
      }
      
      .priority-btn {
        flex: 1;
        padding: 8px;
        border: 1px solid #ddd;
        background: #f5f5f5;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .priority-btn.selected {
        background: #3b82f6;
        color: white;
        border-color: #2563eb;
      }
      
      .priority-btn:hover:not(.selected) {
        background: #e0e7ff;
      }
      
      .action-buttons {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }
      
      .action-btn {
        flex: 1;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        font-weight: bold;
        cursor: pointer;
      }
      
      #calculate-btn {
        background: #10b981;
        color: white;
      }
      
      #calculate-btn:disabled {
        background: #94a3b8;
        cursor: not-allowed;
      }
      
      #reset-btn {
        background: #f3f4f6;
        color: #4b5563;
      }
      
      #ranking-list li {
        margin-bottom: 5px;
        padding: 8px;
        border-radius: 4px;
      }
      
      #ranking-list li:nth-child(1) {
        background-color: #fff6e6;
        font-weight: bold;
      }
      
      #ranking-list li:nth-child(2), #ranking-list li:nth-child(3) {
        background-color: #f9f9fb;
      }
      
      .chart-container {
        margin: 20px 0;
        height: 300px;
        position: relative;
      }
      
      /* 계산 과정 상세 설명 스타일 */
      .chart-explanation-container {
        margin-top: 20px;
        background-color: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #dee2e6;
        padding: 15px;
      }
      
      .calculation-details h4 {
        color: #495057;
        margin-top: 0;
        margin-bottom: 15px;
      }
      
      .priority-info h5, .district-calculation h5 {
        color: #495057;
        margin-top: 10px;
        margin-bottom: 12px;
        font-weight: 600;
      }
      
      .score-details {
        margin-bottom: 15px;
      }
      
      .priority-table, .calculation-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 15px;
        font-size: 0.95em;
      }
      
      .priority-table th, .calculation-table th {
        background-color: #e9ecef;
        padding: 8px;
        text-align: center;
        border: 1px solid #dee2e6;
        font-weight: 600;
      }
      
      .priority-table td, .calculation-table td {
        padding: 6px 8px;
        text-align: center;
        border: 1px solid #dee2e6;
      }
      
      .calculation-table tr:hover {
        background-color: #f1f3f5;
      }
      
      .total-row {
        font-weight: bold;
        background-color: #e9ecef;
      }
      
      .total-label {
        text-align: right;
        padding-right: 10px;
      }
      
      .total-value {
        text-align: center;
        color: #2563eb;
      }
      
      .score-details hr {
        margin: 15px 0;
        border: 0;
        height: 1px;
        background-color: #dee2e6;
      }
      
      @media (max-width: 900px) {
        .container {
          flex-direction: column;
        }
        .left-map,
        .right-panel {
          width: 100%;
          min-width: 0;
          margin-right: 0 !important;
        }
        .left-map {
          height: 50%;
        }
        .right-panel {
          height: 50%;
          flex-direction: row;
        }
        .right-top,
        .right-bottom {
          flex: 1;
          padding: 1rem;
          border-bottom: none;
          border-right: 1px solid #e5e7eb;
        }
        .right-bottom {
          border-right: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">부산에서 강아지 키우기 좋은 동네</div>
    <div class="container">
      <div class="left-map">
        <iframe
          class="map-iframe"
          src="./vet_hospitals_busan_map.html"
        ></iframe>
      </div>
      <div class="right-panel">
        <div class="right-top">

    <div class="custom-recommendation">
        <h3>🎯 맞춤형 동네 추천</h3>
        <p>시설 우선순위를 선택하여 나에게 맞는 동네를 찾아보세요.</p>
        
        <div class="priority-selection">
            <div class="priority-group">
                <h4>🏥 동물병원</h4>
                <div class="priority-buttons">
                    <button class="priority-btn" data-facility="hospital" data-priority="1">1순위</button>
                    <button class="priority-btn" data-facility="hospital" data-priority="2">2순위</button>
                    <button class="priority-btn" data-facility="hospital" data-priority="3">3순위</button>
                </div>
            </div>
            
            <div class="priority-group">
                <h4>☕ 애견카페</h4>
                <div class="priority-buttons">
                    <button class="priority-btn" data-facility="cafe" data-priority="1">1순위</button>
                    <button class="priority-btn" data-facility="cafe" data-priority="2">2순위</button>
                    <button class="priority-btn" data-facility="cafe" data-priority="3">3순위</button>
                </div>
            </div>
            
            <div class="priority-group">
                <h4>🌳 공원</h4>
                <div class="priority-buttons">
                    <button class="priority-btn" data-facility="park" data-priority="1">1순위</button>
                    <button class="priority-btn" data-facility="park" data-priority="2">2순위</button>
                    <button class="priority-btn" data-facility="park" data-priority="3">3순위</button>
                </div>
            </div>
            
            <div class="action-buttons">
                <button id="calculate-btn" class="action-btn" disabled>결과 계산하기</button>
                <button id="reset-btn" class="action-btn">초기화</button>
            </div>
        </div>
        
        
        <div class="ranking-container">
            <h4>맞춤 추천 순위 (Top 3)</h4>
            <ol id="ranking-list">
                <!-- 순위는 JavaScript로 동적 생성 -->
            </ol>
        </div>
        <div class="chart-container">
            <canvas id="ranking-chart"></canvas>
        </div>
        
        <div class="chart-explanation-container">
            <div class="calculation-details">
                <h4>TOP 3 동네 점수 계산 과정</h4>
                <div id="calculation-explanation" class="score-details">
                    <!-- 여기에 동적으로 계산 과정이 표시됩니다 -->
                </div>
            </div>
            
            <div class="explanation">
                <h4>점수 계산 방식 설명</h4>
                <p>현재 점수 계산은 정규화(Normalization)와 최소 요구사항 필터링을 적용한 방식입니다.</p>
                
                <h5>1. 정규화 적용</h5>
                <p class="calc-detail">각 시설 유형(동물병원, 애견카페, 공원)별로 지역 간 비교를 공정하게 하기 위해 시설 수를 0~1 사이 값으로 정규화합니다.</p>
                <ul class="guide-list">
                    <li>정규화 공식: (해당 지역 시설 수 - 최소 시설 수) / (최대 시설 수 - 최소 시설 수)</li>
                </ul>
                
                <h5>2. 최소 요구사항 필터링</h5>
                <p class="calc-detail">1순위로 선택한 시설이 최소 1개 이상 있는 지역만 결과에 포함됩니다.</p>
                <ul class="guide-list">
                    <li>예: 애견카페를 1순위로 선택하면, 애견카페가 없는 지역은 아무리 다른 점수가 높아도 제외됩니다.</li>
                </ul>
                
                <h5>3. 가중치 적용 및 최종 점수 계산</h5>
                <p class="calc-detail">정규화된 시설 수에 우선순위별 가중치를 곱하여 최종 점수를 계산합니다.</p>
                <ul class="guide-list">
                    <li>1순위: 가중치 2.0점</li>
                    <li>2순위: 가중치 1.5점</li>
                    <li>3순위: 가중치 1.0점</li>
                    <li>최종 점수 = (동물병원 정규화 점수 × 병원 가중치) + (애견카페 정규화 점수 × 카페 가중치) + (공원 정규화 점수 × 공원 가중치)</li>
                </ul>
            </div>
        </div>
        
        <div class="small-note">
            <small>※ 부산 전체에는 동물병원 447개, 애견카페 67개, 공원 879개가 있습니다.</small>
        </div>
    </div>

    <style>
        .custom-recommendation {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .weight-sliders {
            margin: 20px 0;
        }
        
        .slider-container {
            margin-bottom: 15px;
        }
        
        .weight-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: #f0f0f0;
            outline: none;
            border-radius: 5px;
        }
        
        .weight-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #4285f4;
            cursor: pointer;
        }
        
        .chart-container {
            margin: 20px 0;
            height: 300px;
            position: relative;
        }
        
        .ranking-container {
            margin-top: 20px;
        }
        
        #ranking-list li {
            margin-bottom: 5px;
            padding: 8px;
            border-radius: 4px;
        }
        
        #ranking-list li:nth-child(1) {
            background-color: #fff6e6;
            font-weight: bold;
        }
        
        #ranking-list li:nth-child(2), #ranking-list li:nth-child(3) {
            background-color: #f9f9fb;
        }
        
        .explanation {
            margin-top: 15px;
            color: #666;
            font-size: 0.9em;
        }
        
        .explanation small {
            display: block;
            margin-bottom: 5px;
        }
    </style>
    
</div>
            

        </div>
        

        
    </div>

    <style>
        .custom-recommendation {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .weight-sliders {
            margin: 20px 0;
        }
        
        .slider-container {
            margin-bottom: 15px;
        }
        
        .weight-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: #f0f0f0;
            outline: none;
            border-radius: 5px;
        }
        
        .weight-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #4285f4;
            cursor: pointer;
        }
        
        .chart-container {
            margin: 20px 0;
            height: 300px;
            position: relative;
        }
        
        .ranking-container {
            margin-top: 20px;
        }
        
        #ranking-list li {
            margin-bottom: 5px;
            padding: 8px;
            border-radius: 4px;
        }
        
        #ranking-list li:nth-child(1) {
            background-color: #fff6e6;
            font-weight: bold;
        }
        
        #ranking-list li:nth-child(2), #ranking-list li:nth-child(3) {
            background-color: #f9f9fb;
        }
        
        .explanation {
            margin-top: 15px;
            color: #666;
            font-size: 0.9em;
        }
        
        .explanation small {
            display: block;
            margin-bottom: 5px;
        }
        
        .guide-list {
            padding-left: 1.5rem;
        }
        .guide-list li {
            margin-bottom: 0.8rem;
        }
        .legend {
            margin-top: 1.5rem;
        }
    </style>
</div>

<script>
// 행정동별 시설 데이터 (filter_park_only로 필터링된 실제 데이터 기준)
const districtData = [
];


// 가중치 설정
const weights = {
    hospital: { value: 0, priority: 0 },
    cafe: { value: 0, priority: 0 },
    park: { value: 0, priority: 0 }
};

// 가중치 값 정의
const priorityValues = {
    1: 2.0,   // 1순위: 2점
    2: 1.5,   // 2순위: 1.5점
    3: 1.0    // 3순위: 1점
};

let rankingChart = null;

// DOM 로딩 후 초기화
document.addEventListener('DOMContentLoaded', () => {
    // 우선순위 버튼에 이벤트 리스너 추가
    const priorityButtons = document.querySelectorAll('.priority-btn');
    priorityButtons.forEach(btn => {
        btn.addEventListener('click', handlePrioritySelection);
    });

    // 계산 버튼 이벤트
    document.getElementById('calculate-btn').addEventListener('click', calculateRanking);
    
    // 초기화 버튼 이벤트
    document.getElementById('reset-btn').addEventListener('click', resetPriorities);
});

// 우선순위 선택 처리
function handlePrioritySelection(e) {
    const facility = e.target.dataset.facility;
    const priority = parseInt(e.target.dataset.priority);
    
    // 같은 시설의 다른 버튼에서 선택 해제
    const facilityButtons = document.querySelectorAll(`.priority-btn[data-facility="${facility}"]`);
    facilityButtons.forEach(btn => btn.classList.remove('selected'));
    
    // 현재 버튼에 선택 표시
    e.target.classList.add('selected');
    
    // 다른 시설에서 같은 우선순위를 가진 버튼 찾기
    Object.keys(weights).forEach(key => {
        if (key !== facility && weights[key].priority === priority) {
            // 다른 시설의 같은 우선순위 버튼 선택 해제
            const conflictButtons = document.querySelectorAll(`.priority-btn[data-facility="${key}"][data-priority="${priority}"]`);
            conflictButtons.forEach(btn => btn.classList.remove('selected'));
            
            // 해당 시설의 우선순위 초기화
            weights[key].priority = 0;
            weights[key].value = 0;
        }
    });
    
    // 우선순위 및 가중치 설정
    weights[facility].priority = priority;
    
    // 계산 버튼 활성화 여부 결정
    updateCalculateButtonState();
}

// 계산 버튼 활성화 상태 업데이트
function updateCalculateButtonState() {
    // 3개 시설 모두 우선순위가 설정되었는지 확인
    const isAllSet = Object.values(weights).every(w => w.priority > 0);
    document.getElementById('calculate-btn').disabled = !isAllSet;
}

// 우선순위 초기화
function resetPriorities() {
    // 모든 선택 버튼 해제
    document.querySelectorAll('.priority-btn').forEach(btn => {
        btn.classList.remove('selected');
    });
    
    // 가중치 초기화
    Object.keys(weights).forEach(key => {
        weights[key].priority = 0;
        weights[key].value = 0;
    });
    
    // 계산 버튼 비활성화
    document.getElementById('calculate-btn').disabled = true;
    
    // 순위 목록 및 차트 초기화
    document.getElementById('ranking-list').innerHTML = '';
    if (rankingChart) {
        rankingChart.destroy();
        rankingChart = null;
    }
}

// 순위 계산 및 표시
function calculateRanking() {
    // 각 시설 유형별 최소값과 최대값 계산 (정규화를 위해)
    let minMax = {
        hospital: { min: Number.MAX_VALUE, max: 0 },
        cafe: { min: Number.MAX_VALUE, max: 0 },
        park: { min: Number.MAX_VALUE, max: 0 }
    };
    
    // 최소값/최대값 찾기
    districtData.forEach(district => {
        minMax.hospital.min = Math.min(minMax.hospital.min, district.hospital);
        minMax.hospital.max = Math.max(minMax.hospital.max, district.hospital);
        
        minMax.cafe.min = Math.min(minMax.cafe.min, district.cafe);
        minMax.cafe.max = Math.max(minMax.cafe.max, district.cafe);
        
        minMax.park.min = Math.min(minMax.park.min, district.park);
        minMax.park.max = Math.max(minMax.park.max, district.park);
    });
    
    // 1순위로 설정된 시설 타입 찾기
    const firstPriorityType = Object.keys(weights).find(key => weights[key].priority === 1);
    const secondPriorityType = Object.keys(weights).find(key => weights[key].priority === 2);
    const thirdPriorityType = Object.keys(weights).find(key => weights[key].priority === 3);
    
    // 각 동네별 점수 계산 (정규화 적용)
    const scores = districtData.map(district => {
        // 정규화된 값 계산 (최소값이 최대값과 같으면 0으로 설정)
        let normalizedHospital = minMax.hospital.max === minMax.hospital.min ? 
            0 : (district.hospital - minMax.hospital.min) / (minMax.hospital.max - minMax.hospital.min);
            
        let normalizedCafe = minMax.cafe.max === minMax.cafe.min ? 
            0 : (district.cafe - minMax.cafe.min) / (minMax.cafe.max - minMax.cafe.min);
            
        let normalizedPark = minMax.park.max === minMax.park.min ? 
            0 : (district.park - minMax.park.min) / (minMax.park.max - minMax.park.min);
        
        // 정규화된 값에 가중치 적용하여 점수 계산
        const hospitalWeightedScore = normalizedHospital * weights.hospital.value;
        const cafeWeightedScore = normalizedCafe * weights.cafe.value;
        const parkWeightedScore = normalizedPark * weights.park.value;
        
        const score = hospitalWeightedScore + cafeWeightedScore + parkWeightedScore;
        
        // 원래 값과 정규화된 값을 모두 저장
        return {
            district: district.district,
            rawScore: score, // 정렬용 원시 점수
            score: score.toFixed(2), // 표시용 점수 (소수점 2자리)
            hospital: district.hospital,
            cafe: district.cafe,
            park: district.park,
            // 정규화된 값 저장
            normalizedHospital: normalizedHospital,
            normalizedCafe: normalizedCafe,
            normalizedPark: normalizedPark,
            // 가중치 적용 값 저장
            hospitalWeightedScore: hospitalWeightedScore,
            cafeWeightedScore: cafeWeightedScore,
            parkWeightedScore: parkWeightedScore,
            // 우선순위 정보 저장
            firstPriorityType: firstPriorityType,
            secondPriorityType: secondPriorityType,
            thirdPriorityType: thirdPriorityType,
            // 1순위 시설의 존재 여부 플래그 추가
            hasFirstPriority: district[firstPriorityType] > 0
        };
    });
    
    // 최소 요구사항 필터링: 1순위 시설이 없는 지역 제외
    const filteredScores = scores.filter(item => item.hasFirstPriority);
    
    // 점수가 없으면 기본 메시지 표시
    if (filteredScores.length === 0) {
        document.getElementById('ranking-list').innerHTML = 
            '<li>1순위 시설을 보유한 지역이 없습니다. 다른 우선순위를 선택해보세요.</li>';
        
        if (rankingChart) {
            rankingChart.destroy();
            rankingChart = null;
        }
        
        // 계산 과정 영역 초기화
        document.getElementById('calculation-explanation').innerHTML = '';
        return;
    }
    
    // 점수 기준 내림차순 정렬
    filteredScores.sort((a, b) => b.rawScore - a.rawScore);
    
    // Top 3만 추출 (또는 가용한 모든 지역)
    const top3 = filteredScores.slice(0, Math.min(3, filteredScores.length));
    
    // 순위 목록 업데이트
    updateRankingList(top3);
    
    // 차트 업데이트
    updateRankingChart(top3);
    
    // 계산 과정 상세 설명 업데이트
    updateCalculationExplanation(top3, minMax);
}

// 순위 목록 업데이트
function updateRankingList(topDistricts) {
    const rankingList = document.getElementById('ranking-list');
    rankingList.innerHTML = '';
    
    topDistricts.forEach((district, index) => {
        const listItem = document.createElement('li');
        listItem.innerHTML = `${index + 1}위: ${district.district} (점수: ${district.score}, 동물병원: ${district.hospital}개, 애견카페: ${district.cafe}개, 공원: ${district.park}개)`;
        rankingList.appendChild(listItem);
    });
    
    // 계산 과정 상세 설명 업데이트
    updateCalculationExplanation(topDistricts);
}

// 계산 과정 상세 설명 업데이트
function updateCalculationExplanation(topDistricts, minMax) {
    const explanationList = document.getElementById('calculation-explanation');
    explanationList.innerHTML = '';
    
    // 우선순위 표시 테이블 생성
    const prioritySection = document.createElement('div');
    prioritySection.className = 'priority-info';
    prioritySection.innerHTML = '<h5>현재 우선순위 설정</h5>';
    
    const priorityTable = document.createElement('table');
    priorityTable.className = 'priority-table';
    
    // 테이블 헤더
    const headerRow = document.createElement('tr');
    headerRow.innerHTML = '<th>순위</th><th>시설 유형</th><th>가중치</th>';
    priorityTable.appendChild(headerRow);
    
    // 각 우선순위별 시설 및 가중치 표시
    
    const priorities = [
        { type: firstDistrict.firstPriorityType, rank: 1, weight: weights[firstDistrict.firstPriorityType].value },
        { type: firstDistrict.secondPriorityType, rank: 2, weight: weights[firstDistrict.secondPriorityType].value },
        { type: firstDistrict.thirdPriorityType, rank: 3, weight: weights[firstDistrict.thirdPriorityType].value }
    
    // 시설 이름 한글화
    const facilityNames = {
        hospital: '동물병원',
        cafe: '애견카페',
        park: '공원'
    };
    
    // 우선순위 행 생성
    priorities.forEach(priority => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${priority.rank}순위</td><td>${facilityNames[priority.type]}</td><td>${priority.weight}</td>`;
        priorityTable.appendChild(row);
    });
    
    prioritySection.appendChild(priorityTable);
    explanationList.appendChild(prioritySection);
    
    // 구분선 추가
    const divider = document.createElement('hr');
    explanationList.appendChild(divider);
    
    // 각 동네별 계산 과정 표시
    topDistricts.forEach((district, index) => {
        const districtSection = document.createElement('div');
        districtSection.className = 'district-calculation';
        
        const header = document.createElement('h5');
        header.innerHTML = `${index + 1}위: ${district.district} (최종 점수: ${district.score})`;
        districtSection.appendChild(header);
        
        // 계산 테이블 생성
        const calcTable = document.createElement('table');
        calcTable.className = 'calculation-table';
        
        // 테이블 헤더
        const calcHeaderRow = document.createElement('tr');
        calcHeaderRow.innerHTML = '<th>시설 유형</th><th>시설 수</th><th>정규화 값</th><th>우선순위</th><th>가중치</th><th>가중치 적용 점수</th>';
        calcTable.appendChild(calcHeaderRow);
        
        // 각 시설 유형별 계산 행 생성
        
        facilityKeys.forEach((key, i) => {
            const row = document.createElement('tr');
            
            // 우선순위 확인
            let priorityRank = 0;
            if (district.firstPriorityType === key) priorityRank = 1;
            else if (district.secondPriorityType === key) priorityRank = 2;
            else if (district.thirdPriorityType === key) priorityRank = 3;
            
            row.innerHTML = `
                <td>${facilityTypes[i]}</td>
                <td>${district[key]}</td>
                <td>${district['normalized'+key.charAt(0).toUpperCase()+key.slice(1)].toFixed(2)}</td>
                <td>${priorityRank}순위</td>
                <td>${weights[key].value}</td>
                <td>${district[key+'WeightedScore'].toFixed(2)}</td>
            `;
            calcTable.appendChild(row);
        });
        
        // 총계 행 추가
        const totalRow = document.createElement('tr');
        totalRow.className = 'total-row';
        totalRow.innerHTML = `
            <td colspan="5" class="total-label">총계 점수</td>
            <td class="total-value">${district.score}</td>
        `;
        calcTable.appendChild(totalRow);
        
        districtSection.appendChild(calcTable);
        explanationList.appendChild(districtSection);
        
        // 동네 구분선 추가 (마지막 동네 제외)
        if (index < topDistricts.length - 1) {
            const districtDivider = document.createElement('hr');
            explanationList.appendChild(districtDivider);
        }
    });
}

// 순위 차트 업데이트
function updateRankingChart(topDistricts) {
    const ctx = document.getElementById('ranking-chart').getContext('2d');
    
    // 기존 차트가 있으면 제거
    if (rankingChart) {
        rankingChart.destroy();
    }
    
    // 새로운 차트 생성
    rankingChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: topDistricts.map(d => d.district),
            datasets: [{
                label: '종합 점수',
                data: topDistricts.map(d => d.score),
                backgroundColor: [
                    'rgba(255, 159, 64, 0.7)',  // 1위 - 주황색
                    'rgba(75, 192, 192, 0.7)',  // 2위 - 청록색
                    'rgba(153, 102, 255, 0.7)'  // 3위 - 보라색
                ],
                borderColor: [
                    'rgb(255, 159, 64)',
                    'rgb(75, 192, 192)',
                    'rgb(153, 102, 255)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: '우리집 강아지에게 좋은 동네 TOP 3',
                    font: {
                        size: 16
                    }
                },
                tooltip: {
                    callbacks: {
                        afterLabel: function(context) {
                            return [
                                `동물병원: ${district.hospital}개`,
                                `애견카페: ${district.cafe}개`,
                                `공원: ${district.park}개`
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: '종합 점수'
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: '행정동'
                    }
                }
            }
        }
    });
}
</script>
            padding: 0.8rem;
            background: #f9f9fb;
            border-radius: 6px;
        }
        .legend h4 {
            margin-top: 0;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.4rem;
        }
        .marker {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .red { background-color: red; }
        .blue { background-color: blue; }
        .green { background-color: green; }
        h3 {
            color: #1f2937;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 0.5rem;
            margin-top: 0;
        }
    </style>
    
    
    
    <h3>📊 시설별 상위 행정동</h3>
    <div class="facilities-tables">
        <div class="facility-table">
            <h4>🏥 동물병원 TOP 5</h4>
            <table class="rank-table">
                <thead>
                    <tr>
                        <th>순위</th>
                        <th>행정동</th>
                        <th>개수</th>
                    </tr>
                </thead>
                <tbody>

                    <tr class="first-rank">
                        <td>1</td>
                        <td>좌2동</td>
                        <td>17</td>
                    </tr>
        
                    <tr class="">
                        <td>2</td>
                        <td>양정1동</td>
                        <td>14</td>
                    </tr>
        
                    <tr class="">
                        <td>3</td>
                        <td>구서1동</td>
                        <td>11</td>
                    </tr>
        
                    <tr class="">
                        <td>4</td>
                        <td>우3동</td>
                        <td>11</td>
                    </tr>
        
                    <tr class="">
                        <td>5</td>
                        <td>중1동</td>
                        <td>11</td>
                    </tr>
        
                </tbody>
            </table>
        </div>
        <div class="facility-table">
            <h4>☕ 애견카페 TOP 5</h4>
            <table class="rank-table">
                <thead>
                    <tr>
                        <th>순위</th>
                        <th>행정동</th>
                        <th>개수</th>
                    </tr>
                </thead>
                <tbody>

                    <tr class="first-rank">
                        <td>1</td>
                        <td>민락동</td>
                        <td>4</td>
                    </tr>
        
                    <tr class="">
                        <td>2</td>
                        <td>정관읍</td>
                        <td>3</td>
                    </tr>
        
                    <tr class="">
                        <td>3</td>
                        <td>명지1동</td>
                        <td>3</td>
                    </tr>
        
                    <tr class="">
                        <td>4</td>
                        <td>부전2동</td>
                        <td>3</td>
                    </tr>
        
                    <tr class="">
                        <td>5</td>
                        <td>다대2동</td>
                        <td>3</td>
                    </tr>
        
                </tbody>
            </table>
        </div>
        <div class="facility-table">
            <h4>🌳 공원 TOP 5</h4>
            <table class="rank-table">
                <thead>
                    <tr>
                        <th>순위</th>
                        <th>행정동</th>
                        <th>개수</th>
                    </tr>
                </thead>
                <tbody>

                    <tr class="first-rank">
                        <td>1</td>
                        <td>녹산동</td>
                        <td>89</td>
                    </tr>
        
                    <tr class="">
                        <td>2</td>
                        <td>삼락동</td>
                        <td>74</td>
                    </tr>
        
                    <tr class="">
                        <td>3</td>
                        <td>정관읍</td>
                        <td>67</td>
                    </tr>
        
                    <tr class="">
                        <td>4</td>
                        <td>기장읍</td>
                        <td>64</td>
                    </tr>
        
                    <tr class="">
                        <td>5</td>
                        <td>부전1동</td>
                        <td>54</td>
                    </tr>
        
                </tbody>
            </table>
        </div>
    </div>
    

    
</div>


      </div>
    </div>
  <!-- Kakao 장소 필터링을 위한 스크립트 추가 -->  
  <script>
    // 걸을 수 있는 장소 카테고리
    const FILTER_CATEGORIES = [
      '도보여행',
      '둘레길',
      '하천',
      '공원',
      '산책로',
      '산책길',
      '산',
      '등산',
      '동산',
      '수목원',
      '생태공원',
      '자연공원',
      '마을공원',
      '강변공원',

    // 공원으로 간주되는 카테고리 키워드
    const PARK_KEYWORDS = [
      '공원',
      '수목원',
      '생태공원',
      '자연공원',
      '마을공원',

    // 공원으로 필터링 할 때 제외할 장소 키워드
    const PARK_EXCLUSION_KEYWORDS = [
      '화장실',
      '주차장',
      '관리소',
      '매표소',
      '사무소',
      '센터',
      '안내소',
      '관리실',
      '관리단',
      '관광안내소',

    /**
     * 카테고리 기반 장소 필터링
     * @param {Array} places - 카카오 장소 검색 결과
     * @returns {Array} - 필터링된 장소 목록
     */
    function filterPlacesByCategory(places) {
      return places.filter((place) => {
        const categories = place.category_name.split(` > `);
        return FILTER_CATEGORIES.some((keyword) => categories.includes(keyword));
      });
    }

    /**
     * 엄격한 필터링 - 여행 > 관광,명소 카테고리에 속한 장소만 필터링
     * @param {Array} places - 카카오 장소 검색 결과
     * @returns {Array} - 필터링된 장소 목록
     */
    function filterPlacesStrict(places) {
      return places.filter((place) => {
        const categories = place.category_name.split(` > `);
        // 여행 > 관광,명소 카테고리에 속하는지 확인
        const isValidPath =
          categories[0] === '여행' && categories[1] === '관광,명소';
        if (!isValidPath) return false;

        // 필터링 카테고리에 속하는지 확인
        return FILTER_CATEGORIES.some((keyword) => categories.includes(keyword));
      });
    }

    /**
     * 공원만 필터링하고 불필요한 장소(화장실, 주차장 등) 제외
     * @param {Array} places - 카카오 장소 검색 결과
     * @returns {Array} - 필터링된 장소 목록
     */
    function filterParkOnly(places) {
      return places.filter((place) => {
        const categories = place.category_name.split(` > `);
        const placeName = place.place_name || '';
        
        // 공원 키워드를 포함하는지 확인
        const isPark = PARK_KEYWORDS.some((keyword) =>
          categories.includes(keyword) || placeName.includes(keyword)
        );
        
        if (!isPark) return false;
        
        // 제외할 키워드가 포함되어 있는지 확인
        const hasExclusionKeyword = PARK_EXCLUSION_KEYWORDS.some((keyword) =>
          placeName.includes(keyword)
        );
        
        return isPark && !hasExclusionKeyword;
      });
    }

    /**
     * 카카오 키워드 검색 수행 후 결과 필터링
     * @param {Object} placesService - 카카오 장소 검색 서비스 객체
     * @param {string} keyword - 검색 키워드
     * @param {function} callback - 결과를 처리할 콜백 함수
     * @param {function} filterFn - 필터링 함수 (기본값: filterParkOnly)
     */
    function searchAndFilterPlaces(
      placesService,
      keyword,
      callback,
      filterFn = filterParkOnly
    ) {
      placesService.keywordSearch(keyword, (result, status) => {
        if (status === kakao.maps.services.Status.OK) {
          // 결과 필터링
          const filteredPlaces = filterFn(result);
          callback(filteredPlaces);
        } else {
          callback([]);
        }
      });
    }

    // 페이지 로드 시 실행: 이 HTML이 정적 데이터만 가지고 있기 때문에 
    // 필터링을 적용할 후속 구현을 위한 시작점으로 사용할 수 있습니다.
    document.addEventListener('DOMContentLoaded', function() {
      console.log('카카오 장소 필터링 기능이 준비되었습니다.');
      console.log('filterParkOnly, filterPlacesByCategory, filterPlacesStrict 함수를 사용할 수 있습니다.');
      console.log('searchAndFilterPlaces 함수를 통해 검색과 필터링을 한 번에 수행할 수 있습니다.');
    });
  </script>
  </body>
</html>
// 행정동별 시설 데이터 (filter_park_only로 필터링된 실제 데이터 기준)
const districtData = [
    { district: '좌2동', hospital: 17, cafe: 1, park: 0 },
    { district: '양정1동', hospital: 14, cafe: 0, park: 0 },
    { district: '구서1동', hospital: 11, cafe: 0, park: 0 },
    { district: '우3동', hospital: 11, cafe: 0, park: 0 },
    { district: '중1동', hospital: 11, cafe: 0, park: 0 },
    { district: '명지1동', hospital: 7, cafe: 3, park: 0 },
    { district: '장전2동', hospital: 10, cafe: 0, park: 0 },
    { district: '민락동', hospital: 5, cafe: 3, park: 1 },
    { district: '기장읍', hospital: 6, cafe: 0, park: 2 },
    { district: '남천1동', hospital: 7, cafe: 1, park: 0 },
    { district: '우1동', hospital: 6, cafe: 0, park: 2 },
    { district: '일광읍', hospital: 4, cafe: 2, park: 2 },
    { district: '정관읍', hospital: 5, cafe: 2, park: 1 },
    { district: '화명3동', hospital: 5, cafe: 1, park: 2 },
    { district: '남포동', hospital: 5, cafe: 2, park: 0 },
    { district: '녹산동', hospital: 6, cafe: 0, park: 1 },
    { district: '대연3동', hospital: 5, cafe: 1, park: 1 },
    { district: '온천2동', hospital: 7, cafe: 0, park: 0 },
    { district: '우2동', hospital: 6, cafe: 0, park: 1 },
    { district: '광안2동', hospital: 5, cafe: 1, park: 0 },
    { district: '다대1동', hospital: 4, cafe: 1, park: 1 },
    { district: '망미1동', hospital: 6, cafe: 0, park: 0 },
    { district: '부곡3동', hospital: 6, cafe: 0, park: 0 },
    { district: '연산1동', hospital: 5, cafe: 0, park: 1 },
    { district: '연산2동', hospital: 6, cafe: 0, park: 0 },
    { district: '연산9동', hospital: 6, cafe: 0, park: 0 },
    { district: '연지동', hospital: 5, cafe: 0, park: 1 },
    { district: '온천1동', hospital: 5, cafe: 0, park: 1 },
    { district: '온천3동', hospital: 6, cafe: 0, park: 0 },
    { district: '용호1동', hospital: 6, cafe: 0, park: 0 },
    { district: '좌1동', hospital: 5, cafe: 1, park: 0 },
    { district: '다대2동', hospital: 3, cafe: 2, park: 0 },
    { district: '명륜동', hospital: 5, cafe: 0, park: 0 },
    { district: '명지2동', hospital: 4, cafe: 0, park: 1 },
    { district: '반여1동', hospital: 5, cafe: 0, park: 0 },
    { district: '송정동', hospital: 4, cafe: 0, park: 1 },
    { district: '연산5동', hospital: 5, cafe: 0, park: 0 },
    { district: '재송1동', hospital: 4, cafe: 1, park: 0 },
    { district: '전포2동', hospital: 4, cafe: 1, park: 0 },
    { district: '초읍동', hospital: 5, cafe: 0, park: 0 },
    { district: '화명1동', hospital: 5, cafe: 0, park: 0 },
    { district: '괴정3동', hospital: 4, cafe: 0, park: 0 },
    { district: '금곡동', hospital: 4, cafe: 0, park: 0 },
    { district: '남산동', hospital: 4, cafe: 0, park: 0 },
    { district: '당리동', hospital: 3, cafe: 1, park: 0 },
    { district: '덕천2동', hospital: 3, cafe: 0, park: 1 },
    { district: '동삼1동', hospital: 2, cafe: 0, park: 2 },
    { district: '모라1동', hospital: 4, cafe: 0, park: 0 },
    { district: '부전2동', hospital: 3, cafe: 1, park: 0 },
    { district: '사직2동', hospital: 4, cafe: 0, park: 0 },
    { district: '수민동', hospital: 4, cafe: 0, park: 0 },
    { district: '수영동', hospital: 3, cafe: 0, park: 1 },
    { district: '안락2동', hospital: 3, cafe: 1, park: 0 },
    { district: '장림2동', hospital: 4, cafe: 0, park: 0 },
    { district: '전포1동', hospital: 3, cafe: 1, park: 0 },
    { district: '중2동', hospital: 3, cafe: 0, park: 1 },
    { district: '충무동', hospital: 4, cafe: 0, park: 0 },
    { district: '가야2동', hospital: 3, cafe: 0, park: 0 },
    { district: '개금1동', hospital: 3, cafe: 0, park: 0 },
    { district: '거제1동', hospital: 3, cafe: 0, park: 0 },
    { district: '거제2동', hospital: 3, cafe: 0, park: 0 },
    { district: '거제3동', hospital: 2, cafe: 1, park: 0 },
    { district: '광안1동', hospital: 3, cafe: 0, park: 0 },
    { district: '구포2동', hospital: 3, cafe: 0, park: 0 },
    { district: '당감4동', hospital: 3, cafe: 0, park: 0 },
    { district: '덕천1동', hospital: 2, cafe: 1, park: 0 },
    { district: '만덕3동', hospital: 3, cafe: 0, park: 0 },
    { district: '문현2동', hospital: 3, cafe: 0, park: 0 },
    { district: '문현3동', hospital: 3, cafe: 0, park: 0 },
    { district: '부곡2동', hospital: 2, cafe: 1, park: 0 },
    { district: '사직1동', hospital: 3, cafe: 0, park: 0 },
    { district: '안락1동', hospital: 3, cafe: 0, park: 0 },
    { district: '암남동', hospital: 1, cafe: 0, park: 2 },
    { district: '엄궁동', hospital: 3, cafe: 0, park: 0 },
    { district: '연산4동', hospital: 2, cafe: 1, park: 0 },
    { district: '연산6동', hospital: 3, cafe: 0, park: 0 },
    { district: '용호2동', hospital: 2, cafe: 0, park: 1 },
    { district: '용호3동', hospital: 1, cafe: 0, park: 2 },
    { district: '장전1동', hospital: 3, cafe: 0, park: 0 },
    { district: '초량2동', hospital: 2, cafe: 0, park: 1 },
    { district: '하단1동', hospital: 3, cafe: 0, park: 0 },
    { district: '하단2동', hospital: 1, cafe: 1, park: 1 },
    { district: '화명2동', hospital: 3, cafe: 0, park: 0 },
    { district: '가락동', hospital: 0, cafe: 2, park: 0 },
    { district: '가야1동', hospital: 2, cafe: 0, park: 0 },
    { district: '감전동', hospital: 0, cafe: 1, park: 1 },
    { district: '광복동', hospital: 0, cafe: 1, park: 1 },
    { district: '광안4동', hospital: 2, cafe: 0, park: 0 },
    { district: '괘법동', hospital: 2, cafe: 0, park: 0 },
    { district: '구서2동', hospital: 2, cafe: 0, park: 0 },
    { district: '구포1동', hospital: 1, cafe: 1, park: 0 },
    { district: '남항동', hospital: 2, cafe: 0, park: 0 },
    { district: '대연5동', hospital: 2, cafe: 0, park: 0 },
    { district: '대저1동', hospital: 0, cafe: 0, park: 2 },
    { district: '문현4동', hospital: 2, cafe: 0, park: 0 },
    { district: '반송2동', hospital: 2, cafe: 0, park: 0 },
    { district: '부암1동', hospital: 2, cafe: 0, park: 0 },
    { district: '부암3동', hospital: 2, cafe: 0, park: 0 },
    { district: '서2동', hospital: 2, cafe: 0, park: 0 },
    { district: '신평2동', hospital: 2, cafe: 0, park: 0 },
    { district: '장안읍', hospital: 1, cafe: 1, park: 0 },
    { district: '좌4동', hospital: 1, cafe: 0, park: 1 },
    { district: '주례2동', hospital: 2, cafe: 0, park: 0 },
    { district: '청룡노포동', hospital: 0, cafe: 2, park: 0 },
    { district: '초량3동', hospital: 1, cafe: 0, park: 1 },
    { district: '가덕도동', hospital: 0, cafe: 1, park: 0 },
    { district: '감만2동', hospital: 1, cafe: 0, park: 0 },
    { district: '감천1동', hospital: 1, cafe: 0, park: 0 },
    { district: '강동동', hospital: 0, cafe: 1, park: 0 },
    { district: '개금3동', hospital: 1, cafe: 0, park: 0 },
    { district: '광안3동', hospital: 0, cafe: 1, park: 0 },
    { district: '괴정1동', hospital: 1, cafe: 0, park: 0 },
    { district: '괴정4동', hospital: 1, cafe: 0, park: 0 },
    { district: '금성동', hospital: 0, cafe: 0, park: 1 },
    { district: '당감1동', hospital: 0, cafe: 1, park: 0 },
    { district: '대연1동', hospital: 1, cafe: 0, park: 0 },
    { district: '대연6동', hospital: 1, cafe: 0, park: 0 },
    { district: '대저2동', hospital: 0, cafe: 0, park: 1 },
    { district: '덕포1동', hospital: 1, cafe: 0, park: 0 },
    { district: '동대신2동', hospital: 1, cafe: 0, park: 0 },
    { district: '만덕2동', hospital: 1, cafe: 0, park: 0 },
    { district: '명장1동', hospital: 1, cafe: 0, park: 0 },
    { district: '명장2동', hospital: 1, cafe: 0, park: 0 },
    { district: '반송1동', hospital: 1, cafe: 0, park: 0 },
    { district: '반여2동', hospital: 1, cafe: 0, park: 0 },
    { district: '반여4동', hospital: 1, cafe: 0, park: 0 },
    { district: '범일1동', hospital: 1, cafe: 0, park: 0 },
    { district: '범천2동', hospital: 1, cafe: 0, park: 0 },
    { district: '복산동', hospital: 1, cafe: 0, park: 0 },
    { district: '봉래1동', hospital: 1, cafe: 0, park: 0 },
    { district: '부곡1동', hospital: 1, cafe: 0, park: 0 },
    { district: '부곡4동', hospital: 1, cafe: 0, park: 0 },
    { district: '부전1동', hospital: 1, cafe: 0, park: 0 },
    { district: '부평동', hospital: 0, cafe: 1, park: 0 },
    { district: '사직3동', hospital: 1, cafe: 0, park: 0 },
    { district: '삼락동', hospital: 0, cafe: 0, park: 1 },
    { district: '서3동', hospital: 1, cafe: 0, park: 0 },
    { district: '서대신1동', hospital: 1, cafe: 0, park: 0 },
    { district: '서대신3동', hospital: 1, cafe: 0, park: 0 },
    { district: '서대신4동', hospital: 0, cafe: 0, park: 1 },
    { district: '선두구동', hospital: 0, cafe: 0, park: 1 },
    { district: '수정2동', hospital: 1, cafe: 0, park: 0 },
    { district: '수정5동', hospital: 1, cafe: 0, park: 0 },
    { district: '신평1동', hospital: 1, cafe: 0, park: 0 },
    { district: '양정2동', hospital: 1, cafe: 0, park: 0 },
    { district: '영선1동', hospital: 1, cafe: 0, park: 0 },
    { district: '영주2동', hospital: 0, cafe: 0, park: 1 },
    { district: '용호4동', hospital: 0, cafe: 0, park: 1 },
    { district: '우암동', hospital: 0, cafe: 0, park: 1 },
    { district: '장림1동', hospital: 1, cafe: 0, park: 0 },
    { district: '재송2동', hospital: 1, cafe: 0, park: 0 },
    { district: '주례1동', hospital: 1, cafe: 0, park: 0 },
    { district: '주례3동', hospital: 1, cafe: 0, park: 0 },
    { district: '중앙동', hospital: 1, cafe: 0, park: 0 },
    { district: '청학1동', hospital: 1, cafe: 0, park: 0 },
    { district: '청학2동', hospital: 1, cafe: 0, park: 0 },
    { district: '학장동', hospital: 1, cafe: 0, park: 0 }
];